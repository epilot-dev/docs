"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[5765],{35722:(e,t,n)=>{n.d(t,{G:()=>d});var a=n(42858),i=n(67294),r=n(25108);let l=0,o=!1;const s=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??a},d=e=>{let{chart:t,config:n}=e;const d=(0,i.useRef)(null),c=(0,i.useRef)("mermaid-"+l++),[p,m]=(0,i.useState)(""),u=(0,i.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=s(e,u);o||(a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),o=!0);(async()=>{try{const{svg:e}=await a.Z.render(c.current,t);m(e)}catch(e){r.error("Mermaid rendering failed:",e)}})()}),[t,u]),(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const i of n){if("attributes"!==i.type||"data-theme"!==i.attributeName)continue;const n=s(e,u);o=!1,a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),o=!0,c.current="mermaid-"+l++,a.Z.render(c.current,t).then((e=>{let{svg:t}=e;m(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,u]),"undefined"==typeof window?i.createElement("div",{className:"mermaid"},t):i.createElement("div",{ref:d,dangerouslySetInnerHTML:{__html:p}})}},1113:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var a=n(87462),i=(n(67294),n(3905)),r=n(35722);const l={sidebar_position:6},o="Relations",s={unversionedId:"entities/relations",id:"entities/relations",title:"Relations",description:"[API Docs]",source:"@site/docs/entities/relations.md",sourceDirName:"entities",slug:"/entities/relations",permalink:"/docs/entities/relations",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/entities/relations.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"docsSidebar",previous:{title:"Entity API",permalink:"/docs/entities/entity-api"},next:{title:"Capabilities",permalink:"/docs/entities/capabilities"}},d=[{value:"Data Structure",id:"data-structure",children:[],level:2},{value:"Relation References",id:"relation-references",children:[],level:2},{value:"Hydration",id:"hydration",children:[],level:2},{value:"Relation Attributes",id:"relation-attributes",children:[],level:2}],c={toc:d},p="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"relations"},"Relations"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity/#tag/Relations"},"API Docs"),"]\n[",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@epilot/entity-client"},"SDK"),"]"),(0,i.kt)("p",null,"Relations link entities to each other across the epilot platform. Any entity can relate to any other entity, regardless of schema. The Relations tab on each entity detail view shows all linked entities."),(0,i.kt)(r.G,{chart:'flowchart LR\n    Order --\x3e|"contacts (has_many)"| Contact1[Contact A]\n    Order --\x3e|"contacts (has_many)"| Contact2[Contact B]\n    Order --\x3e|"products (has_many)"| Product\n    Contract --\x3e|"billing_address ($relation_ref)"| Contact1',mdxType:"Mermaid"}),(0,i.kt)("h2",{id:"data-structure"},"Data Structure"),(0,i.kt)("p",null,"Relations are stored as a JSON object with a ",(0,i.kt)("inlineCode",{parentName:"p"},"$relation")," array. Each entry references a related entity by ID and can carry ",(0,i.kt)("inlineCode",{parentName:"p"},"_tags")," for classification:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="stored-value"',title:'"stored-value"'},'{\n  "contacts": {\n    "$relation": [\n      {\n        "entity_id": "48e9432b-05e9-44fb-a8c2-8d29d9ceade8",\n        "_tags": ["CEO", "primary"]\n      },\n      {\n        "entity_id": "c0f7ad05-f03d-4d6a-a36a-c85281da28bb",\n        "_tags": ["Head of sales"]\n      }\n    ]\n  }\n}\n')),(0,i.kt)("h2",{id:"relation-references"},"Relation References"),(0,i.kt)("p",null,"Relation references (",(0,i.kt)("inlineCode",{parentName:"p"},"$relation_ref"),") point to a specific attribute on a related entity, avoiding data duplication. This is useful when a contract should reference the billing address or payment method stored on another entity."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="stored-value"',title:'"stored-value"'},'{\n  "billing_address": {\n    "$relation_ref": [\n      {\n        "entity_id": "843f2de0-f71a-43fc-a5f5-908e20c4df25",\n        "path": "address",\n        "_id": "addr1"\n      }\n    ]\n  }\n}\n')),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Field"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"entity_id")),(0,i.kt)("td",{parentName:"tr",align:null},"The related entity's ID")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"path")),(0,i.kt)("td",{parentName:"tr",align:null},"Path to the attribute on the related entity")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"_id")),(0,i.kt)("td",{parentName:"tr",align:null},"Optional: ID of a specific item within a repeatable attribute")))),(0,i.kt)("h2",{id:"hydration"},"Hydration"),(0,i.kt)("p",null,"Pass ",(0,i.kt)("inlineCode",{parentName:"p"},"hydrate=true")," to Entity API operations (",(0,i.kt)("inlineCode",{parentName:"p"},"getEntity"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"searchEntities"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"getRelations"),") to resolve ",(0,i.kt)("inlineCode",{parentName:"p"},"$relation")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"$relation_ref")," references in-place. Each relation entry is expanded to include the full entity data while preserving the original reference metadata."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/docs/entities/entity-api#relations-api"},"Entity API \u2014 Relations API")," for API usage examples."),(0,i.kt)("h2",{id:"relation-attributes"},"Relation Attributes"),(0,i.kt)("p",null,"Relations are defined on schemas as ",(0,i.kt)("a",{parentName:"p",href:"/docs/entities/attributes#relation"},"relation attributes"),". Key schema properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"relation_type")," \u2014 ",(0,i.kt)("inlineCode",{parentName:"li"},'"has_many"')," or ",(0,i.kt)("inlineCode",{parentName:"li"},'"has_one"')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"allowedSchemas")," \u2014 restricts which entity types can be linked"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"reverse_attributes")," \u2014 automatically creates a back-reference on the related entity"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"relation_affinity_mode")," \u2014 ",(0,i.kt)("inlineCode",{parentName:"li"},'"weak"')," (preserved on duplication) or ",(0,i.kt)("inlineCode",{parentName:"li"},'"strong"')," (discarded on duplication)")))}m.isMDXComponent=!0}}]);