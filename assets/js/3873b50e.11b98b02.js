"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[23758],{35722:(e,t,a)=>{a.d(t,{G:()=>s});var n=a(42858),i=a(67294),r=a(25108);let l=0,o=!1;const d=(e,t)=>{const a=e?.getAttribute("data-theme")??"light",n="dark"===a?"dark":"default";return t?.theme?.[a]??t?.mermaid?.theme??n},s=e=>{let{chart:t,config:a}=e;const s=(0,i.useRef)(null),p=(0,i.useRef)("mermaid-"+l++),[m,k]=(0,i.useState)(""),c=(0,i.useMemo)((()=>"string"==typeof a?JSON.parse(a):a),[a]);return(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),a=d(e,c);o||(n.Z.initialize({startOnLoad:!1,theme:a,...c?.mermaid||{}}),o=!0);(async()=>{try{const{svg:e}=await n.Z.render(p.current,t);k(e)}catch(e){r.error("Mermaid rendering failed:",e)}})()}),[t,c]),(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),a=new MutationObserver((a=>{for(const i of a){if("attributes"!==i.type||"data-theme"!==i.attributeName)continue;const a=d(e,c);o=!1,n.Z.initialize({startOnLoad:!1,theme:a,...c?.mermaid||{}}),o=!0,p.current="mermaid-"+l++,n.Z.render(p.current,t).then((e=>{let{svg:t}=e;k(t)}));break}}));return a.observe(e,{attributes:!0}),()=>a.disconnect()}),[t,c]),"undefined"==typeof window?i.createElement("div",{className:"mermaid"},t):i.createElement("div",{ref:s,dangerouslySetInnerHTML:{__html:m}})}},80004:(e,t,a)=>{a.r(t),a.d(t,{contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var n=a(87462),i=(a(67294),a(3905));a(35722);const r={sidebar_position:1},l="Datalake",o={unversionedId:"datalake/epilot-datalake",id:"datalake/epilot-datalake",title:"Datalake",description:"The epilot Datalake streams real-time events for entity operations, workflow executions, journey analytics, and portal analytics into a ClickHouse data warehouse. Connect any BI tool to build reports and dashboards.",source:"@site/docs/datalake/epilot-datalake.mdx",sourceDirName:"datalake",slug:"/datalake/epilot-datalake",permalink:"/docs/datalake/epilot-datalake",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/datalake/epilot-datalake.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"docsSidebar",previous:{title:"AI in epilot",permalink:"/docs/ai/overview"},next:{title:"Audit Logs",permalink:"/docs/audit-logs"}},d=[{value:"Data Schemas",id:"data-schemas",children:[{value:"1. Entity Operations Event Streams",id:"1-entity-operations-event-streams",children:[],level:3},{value:"2. Workflow Execution Snapshots",id:"2-workflow-execution-snapshots",children:[],level:3},{value:"3. Journey Analytics",id:"3-journey-analytics",children:[],level:3},{value:"4. Portal Analytics",id:"4-portal-analytics",children:[],level:3}],level:2},{value:"Setting Up the Datalake",id:"setting-up-the-datalake",children:[{value:"Generate credentials",id:"generate-credentials",children:[],level:3}],level:2},{value:"Querying the Data",id:"querying-the-data",children:[{value:"Direct SQL queries",id:"direct-sql-queries",children:[],level:3},{value:"Connecting to BI tools",id:"connecting-to-bi-tools",children:[],level:3}],level:2},{value:"Interactive Power BI Report: Entity Operations",id:"interactive-power-bi-report-entity-operations",children:[],level:2},{value:"Interactive Power BI Report: Journey Analytics",id:"interactive-power-bi-report-journey-analytics",children:[],level:2}],s={toc:d},p="wrapper";function m(e){let{components:t,...r}=e;return(0,i.kt)(p,(0,n.Z)({},s,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"datalake"},"Datalake"),(0,i.kt)("p",null,"The epilot Datalake streams real-time events for entity operations, workflow executions, journey analytics, and portal analytics into a ",(0,i.kt)("a",{parentName:"p",href:"https://clickhouse.com/"},"ClickHouse")," data warehouse. Connect any BI tool to build reports and dashboards."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Contact customer support or sales to enable the Datalake for your organization."))),(0,i.kt)("h2",{id:"data-schemas"},"Data Schemas"),(0,i.kt)("p",null,"Four datasets are available:"),(0,i.kt)("h3",{id:"1-entity-operations-event-streams"},"1. Entity Operations Event Streams"),(0,i.kt)("p",null,"Real-time event stream of entity create, update, and delete operations."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "activity_id": "string",  // ID for the individual entity operation/activity\n    "entity_id": "string",    // ID of the entity being mutated\n    "org_id": "string",       // Organization ID\n    "operation": "string",    // Operation can be "createEntity," "updateEntity," or "deleteEntity"\n    "schema": "string",       // Schema of the entity\n    "timestamp": "DateTime",  // Timestamp of the entity mutation\n    "detail": "string",       // Stringified JSON payload containing entity data\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"operation")," -- ",(0,i.kt)("inlineCode",{parentName:"li"},"createEntity"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"updateEntity"),", or ",(0,i.kt)("inlineCode",{parentName:"li"},"deleteEntity")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"timestamp")," -- when the operation occurred (useful for time-series reports)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"activity_id")," / ",(0,i.kt)("strong",{parentName:"li"},"entity_id")," -- identifiers for the operation and affected entity"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"detail")," -- stringified JSON of the full entity state at the time of the operation")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The view ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_current_entities_final"))," shows only the latest state of active (non-deleted) entities, simplifying many common queries."))),(0,i.kt)("h3",{id:"2-workflow-execution-snapshots"},"2. Workflow Execution Snapshots"),(0,i.kt)("p",null,"Real-time snapshots of workflow execution data across five tables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_workflow_executions_final"))," -- workflow execution attributes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_workflow_phases_final"))," -- phase attributes for each execution."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_workflow_tasks_final"))," -- individual step/task attributes."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_workflow_cancellations_final"))," -- cancellation reasons."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_workflow_contexts_final"))," -- related entities for each execution.",(0,i.kt)("div",null,(0,i.kt)("iframe",{title:"Workflows DB Schema",width:"100%",height:"600px",src:"https://drawsql.app/teams/epilot/diagrams/workflows/embed"})))),(0,i.kt)("p",null,"See the ",(0,i.kt)("a",{parentName:"p",href:"/api/workflow-execution#tag/Workflows/operation/getExecution"},"Workflow Execution API reference")," for full details."),(0,i.kt)("h3",{id:"3-journey-analytics"},"3. Journey Analytics"),(0,i.kt)("p",null,"Tracks user sessions and interactions for each journey."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Journey sessions schema:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "string",  // Unique identifier for the session (UUID)\n    "org_id": "string",  // Unique identifier for the organization associated with the session (UUID)\n    "journey_id": "string",  // Unique identifier for the user journey to which the session belongs (UUID)\n    "start_time": "datetime",  // Timestamp indicating when the session started\n    "details": "string",  // Additional details about the session, in JSON format\n    "end_time": "datetime",  // Timestamp indicating when the session ended\n    "last_updated_at": "datetime", // Timestamp indicating when was the session last updated at\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"details")," field is a JSON string containing browser session metadata: ",(0,i.kt)("inlineCode",{parentName:"p"},"deviceType"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"osType"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"browserTypeAndVersion"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"screenResolution"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"viewportSize"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"colorDepth"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"languagePreference"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"ip"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"embeddedIn"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"isLauncherJourney"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Journey events schema:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "string",  // Unique identifier for the event (UUID)\n    "org_id": "string",  // Identifier of the organization associated with the event\n    "session_id": "string",  // Unique identifier for the session in which the event occurred (UUID)\n    "journey_id": "string",  // Unique identifier for the user journey to which the event belongs (UUID)\n    "type": "string",  // Type of event (e.g., "step_navigation", "journey_submit", "journey_exit")\n    "details": "string",  // Additional details about the event, typically in JSON format\n    "created_at": "datetime"  // Timestamp indicating when the event was recorded\n}\n')),(0,i.kt)("p",null,"Event types (",(0,i.kt)("inlineCode",{parentName:"p"},"type")," field):"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"journey_load_time")),(0,i.kt)("td",{parentName:"tr",align:null},"Time for the journey to load (API response time).")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"step_navigation")),(0,i.kt)("td",{parentName:"tr",align:null},"User navigated between steps.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"journey_submit")),(0,i.kt)("td",{parentName:"tr",align:null},"User completed and submitted the journey.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"journey_exit")),(0,i.kt)("td",{parentName:"tr",align:null},"User closed or refreshed the journey tab.")))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"details")," field carries event-specific data: ",(0,i.kt)("inlineCode",{parentName:"p"},"fromStepName"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"fromStepNumber"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"toStepName"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"toStepNumber")," for navigation events, ",(0,i.kt)("inlineCode",{parentName:"p"},"stepNumber"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"stepName")," for exit events, and load duration for load-time events."),(0,i.kt)("p",null,"Tables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_journey_sessions_final"))," -- journey session data."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_journey_events_final"))," -- journey event data.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Journey analytics db schema",src:a(65175).Z,width:"697",height:"320"})),(0,i.kt)("h3",{id:"4-portal-analytics"},"4. Portal Analytics"),(0,i.kt)("p",null,"Tracks user sessions and interactions for the customer portal and installer portal."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Portal sessions schema:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "string",  // Unique identifier for the session (UUID)\n    "org_id": "string",  // Identifier of the organization associated with the event\n    "app_name": "string", // Name of the app for which the session was created (customer portal, installer portal etc.)\n    "start_time": "datetime",  // Timestamp indicating when the session started\n    "details": "string",  // Additional details about the session, in JSON format\n    "end_time": "datetime",  // Timestamp indicating when the session ended\n    "last_updated_at": "datetime", // Timestamp indicating when was the session last updated at\n}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"details")," field is a JSON string containing: ",(0,i.kt)("inlineCode",{parentName:"p"},"deviceType"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"osType"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"browserTypeAndVersion"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"screenResolution"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"viewportSize"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"colorDepth"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"languagePreference"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"ip"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"email"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"domainName"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"referrer"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Portal events schema:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id": "string",  // Unique identifier for the event (UUID)\n    "org_id": "string",  // Identifier of the organization associated with the event\n    "session_id": "string",  // Unique identifier for the session in which the event occurred (UUID)\n    "app_name": "string", // Name of the app for which the event was created (customer portal, installer portal etc.)\n    "type": "string",  // Type of event (e.g., "user_logged_in", "page_navigation", etc.)\n    "details": "string",  // Additional details about the event, in JSON format\n    "created_at": "datetime"  // Timestamp indicating when the event was recorded\n}\n')),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Portal event types"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"user_logged_in")),(0,i.kt)("td",{parentName:"tr",align:null},"User logged in.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"user_registered")),(0,i.kt)("td",{parentName:"tr",align:null},"New user registered.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"user_logged_out")),(0,i.kt)("td",{parentName:"tr",align:null},"User logged out.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"user_account_deleted")),(0,i.kt)("td",{parentName:"tr",align:null},"User account deleted.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"user_email_changed")),(0,i.kt)("td",{parentName:"tr",align:null},"User updated email address.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"password_changed")),(0,i.kt)("td",{parentName:"tr",align:null},"User changed password.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"page_navigation")),(0,i.kt)("td",{parentName:"tr",align:null},"User navigated between pages.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"add_contract_initiated")),(0,i.kt)("td",{parentName:"tr",align:null},"User started adding a contract.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"contract_added")),(0,i.kt)("td",{parentName:"tr",align:null},"Contract added.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"contract_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed a contract.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"contracts_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed contract list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"contract_due_date_changed")),(0,i.kt)("td",{parentName:"tr",align:null},"User changed contract due date.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"contract_payment_rate_changed")),(0,i.kt)("td",{parentName:"tr",align:null},"User changed payment rate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"order_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed an order.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"orders_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed order list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"order_accepted")),(0,i.kt)("td",{parentName:"tr",align:null},"User accepted an order.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"order_refused")),(0,i.kt)("td",{parentName:"tr",align:null},"User declined an order.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"opportunity_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed an opportunity.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"opportunities_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed opportunity list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"document_uploaded")),(0,i.kt)("td",{parentName:"tr",align:null},"User uploaded a document.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"document_downloaded")),(0,i.kt)("td",{parentName:"tr",align:null},"User downloaded a document.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"document_deleted")),(0,i.kt)("td",{parentName:"tr",align:null},"User deleted a document.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"documents_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed document list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"all_documents_downloaded")),(0,i.kt)("td",{parentName:"tr",align:null},"User downloaded all documents in a section.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"meter_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed a meter.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"meters_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed meter list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"meter_widget_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed a meter widget.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"meter_reading_submission_initiated")),(0,i.kt)("td",{parentName:"tr",align:null},"User started submitting a meter reading.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"meter_reading_submitted")),(0,i.kt)("td",{parentName:"tr",align:null},"Meter reading submitted.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"journey_opened")),(0,i.kt)("td",{parentName:"tr",align:null},"User opened a journey.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"journey_closed")),(0,i.kt)("td",{parentName:"tr",align:null},"User closed a journey.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"additional_info_update_initiated")),(0,i.kt)("td",{parentName:"tr",align:null},"User started updating custom info.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"additional_info_updated")),(0,i.kt)("td",{parentName:"tr",align:null},"Custom info updated.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"additional_info_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed custom info.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"payments_listing_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed payment list.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"product_viewed")),(0,i.kt)("td",{parentName:"tr",align:null},"User viewed a product.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"teaser_opened")),(0,i.kt)("td",{parentName:"tr",align:null},"User opened a teaser.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"external_website_opened")),(0,i.kt)("td",{parentName:"tr",align:null},"User navigated to an external site."))))),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"details")," field carries event-specific context: page URLs for navigation, entity details for contracts/orders/meters, external links, and custom information updates."),(0,i.kt)("p",null,"Tables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_portal_sessions_final"))," -- portal session data."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"strong"},"{org_id}_portal_events_final"))," -- portal event data.")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Portal analytics db schema",src:a(78993).Z,width:"982",height:"504"})),(0,i.kt)("h2",{id:"setting-up-the-datalake"},"Setting Up the Datalake"),(0,i.kt)("h3",{id:"generate-credentials"},"Generate credentials"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to ",(0,i.kt)("strong",{parentName:"p"},"Settings")," > ",(0,i.kt)("strong",{parentName:"p"},"Data Lake")," in the epilot portal.\n",(0,i.kt)("img",{alt:"Datalake menu",src:a(70814).Z,width:"872",height:"656"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"The Data Lake page lists active credentials. You can revoke existing credentials or create new ones.\n",(0,i.kt)("img",{alt:"Datalake page",src:a(15672).Z,width:"2802",height:"774"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Generate Credentials"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Save the password immediately -- it is shown only once.\n",(0,i.kt)("img",{alt:"Datalake Credentials",src:a(7964).Z,width:"1124",height:"1276"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"username"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"host"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"port"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"database"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," to connect from any BI tool or SQL client."))),(0,i.kt)("h2",{id:"querying-the-data"},"Querying the Data"),(0,i.kt)("p",null,"Connect to ClickHouse and query your data using either approach:"),(0,i.kt)("h3",{id:"direct-sql-queries"},"Direct SQL queries"),(0,i.kt)("p",null,"Write SQL queries against the ClickHouse tables."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example 1: Opportunities created over time")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT\n    count(*) AS count,\n    JSONExtractString(detail, 'payload', 'source', 'title') AS journey_source,\n    toStartOfYear(timestamp) AS year,\n    toStartOfMonth(timestamp) AS month\nFROM entity_operations\nWHERE schema = 'opportunity'\n  AND operation = 'createEntity'\nGROUP BY journey_source, year, month;\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Datalake page",src:a(55944).Z,width:"1924",height:"806"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example 2: Journey sessions over time")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT journey_id, start_time, details\nFROM {org_id}_journey_sessions_final\nWHERE journey_id = {your_journey_id}\n  AND start_time > '2024-08-01 00:00:00';\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Datalake page",src:a(15841).Z,width:"704",height:"523"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example 3: Portal sessions over time")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT app_name, start_time, details\nFROM {org_id}_portal_sessions_final\nWHERE app_name = {your_app_name}\n  AND start_time > '2024-08-01 00:00:00';\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Datalake page",src:a(4210).Z,width:"1544",height:"726"})),(0,i.kt)("p",null,"Use any SQL client that supports ClickHouse. See the ",(0,i.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/integrations/datagrip"},"DataGrip integration guide")," for a walkthrough."),(0,i.kt)("h3",{id:"connecting-to-bi-tools"},"Connecting to BI tools"),(0,i.kt)("p",null,"Connect your preferred BI tool directly to ClickHouse, or use the official ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ClickHouse/clickhouse-odbc/releases"},"ClickHouse ODBC driver"),"."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The walkthrough below demonstrates connecting Power BI for an energy utility company reporting on Wallbox and Energieausweis sales journeys."))),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/integrations/powerbi"},"ClickHouse + Power BI integration")," for connection options."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Steps to create a Power BI report:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Add data source")," -- Install the ODBC driver, then add a new ODBC data source in Power BI.\n",(0,i.kt)("img",{alt:"Power BI ODBC",src:a(84294).Z,width:"1354",height:"1320"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Enter connection details")," -- Provide the ODBC connection string, username, password, and database."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"Driver={ClickHouse ODBC Driver (ANSI)};Server={host};Port=8443;Database=datawarehouse;\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"Power BI Connection",src:a(12070).Z,width:"1398",height:"1052"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Select data")," -- Browse schemas and tables. Look for ",(0,i.kt)("inlineCode",{parentName:"p"},"entity_operations")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"{org_id}_current_entities_final")," view.\n",(0,i.kt)("img",{alt:"Power BI Entity Operations",src:a(48407).Z,width:"1758",height:"1396"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Load or transform")," -- Click ",(0,i.kt)("strong",{parentName:"p"},"Load Data")," for raw import, or ",(0,i.kt)("strong",{parentName:"p"},"Transform")," to preprocess data in Power BI's query editor.\n",(0,i.kt)("img",{alt:"Power BI Current Entities",src:a(36201).Z,width:"1754",height:"1384"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Model data")," -- Create relationships between tables (e.g. entity operations and workflow data).\n",(0,i.kt)("img",{alt:"Power BI Data Model",src:a(81361).Z,width:"2682",height:"590"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Build reports")," -- Use charts, tables, and visuals to present insights.\n",(0,i.kt)("img",{alt:"Power BI Report",src:a(55495).Z,width:"2970",height:"1354"}),"\n",(0,i.kt)("img",{alt:"Power BI Report",src:a(25436).Z,width:"857",height:"492"})))),(0,i.kt)("h2",{id:"interactive-power-bi-report-entity-operations"},"Interactive Power BI Report: Entity Operations"),(0,i.kt)("div",null,(0,i.kt)("iframe",{title:"raven bi",width:"100%",height:"600",src:"https://app.powerbi.com/view?r=eyJrIjoiZDQ4MmQzNzAtODVlYy00MjdiLTg5ODMtNzVhNmMxOTU4OGUzIiwidCI6IjMzZDRmM2U1LTNkZjItNDIxZS1iOTJlLWE2M2NmYTY4MGE4OCJ9",frameborder:"0",allowFullScreen:"true"})),(0,i.kt)("h2",{id:"interactive-power-bi-report-journey-analytics"},"Interactive Power BI Report: Journey Analytics"),(0,i.kt)("div",null,(0,i.kt)("iframe",{title:"raven bi",width:"100%",height:"600",src:"https://app.powerbi.com/view?r=eyJrIjoiZGM2MjI0NzgtZGQ2Zi00NzVjLWFmYjAtZDdhOWVkNmJhYzFiIiwidCI6IjMzZDRmM2U1LTNkZjItNDIxZS1iOTJlLWE2M2NmYTY4MGE4OCJ9",frameborder:"0",allowFullScreen:"true"})),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"https://clickhouse.com/docs/en/integrations/data-visualization"},"ClickHouse data visualization integrations")," for connecting other BI tools."))}m.isMDXComponent=!0},7964:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/datalake-credentials-fafbef14598a9fb836fd46a1e109cc49.png"},70814:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/datalake-menu-fd0a3a932930ddb350df6d76ea239e6e.png"},15672:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/datalake-page-feba4fa5ae043089c3f86290a0c26ed9.png"},65175:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/journey-analytics-db-schema-a6429f1377c411dc860faa987091b2d3.png"},15841:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/journey_analytics_query_result-4ac916336a03776127980dc7f9ba22d1.png"},55944:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/opportunity-time-series-927ebb568a5cd85d7b78840309a9b296.png"},78993:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/portal-analytics-db-schema-b08c6c193d5c39ba2a14c7aa7ea7af0e.png"},4210:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/portal_analytics_query_result-9271db99ba95a03a1f54000d1763c077.png"},12070:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-connection-d7f7368a1631f36e767d9149c2e7c4f8.png"},36201:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-current-entities-dc3c5232582ae3f2d33880eb531e410c.png"},81361:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-data-model-3e7e7fc48dde261f11f00554fb5a3e28.png"},48407:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-entity-operations-86de3c142396214b27c5ea13d7ad3120.png"},25436:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-journey-analytics-report-bc18aea7df800df9d8049ccb96ed7260.png"},84294:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-odbc-826ee26c6e4556feaecc36b0c2b33e95.png"},55495:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/powerbi-report-575b56af8a31334160dfe7aed52c26ca.png"}}]);