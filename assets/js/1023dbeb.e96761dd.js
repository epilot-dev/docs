"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[21124],{35722:(e,t,n)=>{n.d(t,{G:()=>s});var a=n(42858),r=n(67294),l=n(25108);let i=0,o=!1;const d=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??a},s=e=>{let{chart:t,config:n}=e;const s=(0,r.useRef)(null),p=(0,r.useRef)("mermaid-"+i++),[m,u]=(0,r.useState)(""),c=(0,r.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=d(e,c);o||(a.Z.initialize({startOnLoad:!1,theme:n,...c?.mermaid||{}}),o=!0);(async()=>{try{const{svg:e}=await a.Z.render(p.current,t);u(e)}catch(e){l.error("Mermaid rendering failed:",e)}})()}),[t,c]),(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const r of n){if("attributes"!==r.type||"data-theme"!==r.attributeName)continue;const n=d(e,c);o=!1,a.Z.initialize({startOnLoad:!1,theme:n,...c?.mermaid||{}}),o=!0,p.current="mermaid-"+i++,a.Z.render(p.current,t).then((e=>{let{svg:t}=e;u(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,c]),"undefined"==typeof window?r.createElement("div",{className:"mermaid"},t):r.createElement("div",{ref:s,dangerouslySetInnerHTML:{__html:m}})}},220:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>d,toc:()=>s});var a=n(87462),r=(n(67294),n(3905)),l=n(35722);const i={sidebar_position:5,title:"File Proxy",description:"Serve files from external document systems on demand without migrating them into epilot storage",slug:"/integrations/erp-toolkit/file-proxy"},o="File Proxy",d={unversionedId:"integrations/erp-toolkit/file-proxy",id:"integrations/erp-toolkit/file-proxy",title:"File Proxy",description:"Serve files from external document systems on demand without migrating them into epilot storage",source:"@site/docs/integrations/erp-toolkit/file-proxy.md",sourceDirName:"integrations/erp-toolkit",slug:"/integrations/erp-toolkit/file-proxy",permalink:"/docs/integrations/erp-toolkit/file-proxy",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/integrations/erp-toolkit/file-proxy.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"File Proxy",description:"Serve files from external document systems on demand without migrating them into epilot storage",slug:"/integrations/erp-toolkit/file-proxy"},sidebar:"docsSidebar",previous:{title:"Use Cases",permalink:"/docs/integrations/erp-toolkit/use-cases"},next:{title:"Mapping Examples",permalink:"/docs/integrations/erp-toolkit/mapping-examples"}},s=[{value:"How It Works",id:"how-it-works",children:[],level:2},{value:"Basic Structure",id:"basic-structure",children:[],level:2},{value:"Authentication",id:"authentication",children:[],level:2},{value:"Parameters",id:"parameters",children:[],level:2},{value:"Steps",id:"steps",children:[{value:"Handlebars Templates",id:"handlebars-templates",children:[],level:3},{value:"Environment Variable Resolution",id:"environment-variable-resolution",children:[],level:3},{value:"Template Context",id:"template-context",children:[],level:3}],level:2},{value:"Response Extraction",id:"response-extraction",children:[{value:"JSONata Expressions",id:"jsonata-expressions",children:[],level:3},{value:"Response Encoding",id:"response-encoding",children:[],level:3}],level:2},{value:"VPC Routing",id:"vpc-routing",children:[],level:2},{value:"Credentials and Secrets",id:"credentials-and-secrets",children:[{value:"Recommended Environment Variable Naming",id:"recommended-environment-variable-naming",children:[],level:3}],level:2},{value:"Proxy URL Generation",id:"proxy-url-generation",children:[{value:"Automated URL Construction via Inbound Mapping",id:"automated-url-construction-via-inbound-mapping",children:[],level:3}],level:2},{value:"Large File Handling",id:"large-file-handling",children:[],level:2},{value:"Examples",id:"examples",children:[{value:"Single-Step Base64-in-JSON",id:"single-step-base64-in-json",children:[],level:3},{value:"Multi-Step Search + Binary Download",id:"multi-step-search--binary-download",children:[],level:3},{value:"Simple Binary Download",id:"simple-binary-download",children:[],level:3}],level:2},{value:"Validation Rules",id:"validation-rules",children:[{value:"Auth",id:"auth",children:[],level:3},{value:"Params",id:"params",children:[],level:3},{value:"Steps",id:"steps-1",children:[],level:3},{value:"Response",id:"response",children:[],level:3}],level:2},{value:"Best Practices",id:"best-practices",children:[],level:2}],p={toc:s},m="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"file-proxy"},"File Proxy"),(0,r.kt)("p",null,"The File Proxy enables epilot to serve files from external document systems (e.g., ERP document archives, document management systems) ",(0,r.kt)("strong",{parentName:"p"},"on demand"),", without migrating files into epilot's storage. During ",(0,r.kt)("a",{parentName:"p",href:"./inbound/getting-started"},"inbound sync"),", file entities are created with a ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_download_url")," pointing to the file proxy. When a user views the file, epilot's file service verifies the request and the proxy fetches the document from the external system in real time."),(0,r.kt)("p",null,"Each file proxy configuration is stored as a ",(0,r.kt)("strong",{parentName:"p"},"use case")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"type: 'file_proxy'")," within an integration. The configuration describes how to authenticate, which HTTP calls to make, and how to extract the file from the response \u2014 all declaratively, without code changes for new integrations."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Use the File Proxy when migrating a large document archive into epilot is impractical. Instead of transferring file content during inbound sync, only metadata is synced \u2014 the actual file is fetched on demand when a user views it."))),(0,r.kt)("h2",{id:"how-it-works"},"How It Works"),(0,r.kt)(l.G,{chart:"sequenceDiagram\n    participant User as User (360 / Portal)\n    participant FS as epilot File Service\n    participant FP as File Proxy\n    participant Ext as External System\n\n    User->>FS: Click file download\n    FS->>FS: Sign URL, redirect browser\n    User->>FP: GET /download?orgId=...&integrationId=...&useCaseId=...&documentId=...\n    FP->>FS: Verify signed URL (verifyCustomDownloadUrl)\n    FS--\x3e>FP: Valid\n    FP->>FP: Load use case configuration\n    FP->>FP: Resolve environment secrets\n    opt OAuth2 configured\n        FP->>Ext: POST token endpoint\n        Ext--\x3e>FP: Access token\n    end\n    FP->>Ext: Execute HTTP steps\n    Ext--\x3e>FP: File content\n    FP--\x3e>User: File response",mdxType:"Mermaid"}),(0,r.kt)("h2",{id:"basic-structure"},"Basic Structure"),(0,r.kt)("p",null,"A file proxy use case configuration has four top-level sections:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "auth": {\n    "type": "oauth2_client_credentials",\n    "token_url": "\\\\{{env.erp.token_url}}",\n    "client_id": "\\\\{{env.erp.client_id}}",\n    "client_secret": "\\\\{{env.erp.client_secret}}"\n  },\n  "params": [\n    { "name": "documentId", "required": true, "description": "External document ID" }\n  ],\n  "steps": [\n    {\n      "url": "\\\\{{env.erp.base_url}}/documents/{{params.documentId}}",\n      "method": "GET",\n      "response_type": "json"\n    }\n  ],\n  "response": {\n    "body": "steps[0].body.data",\n    "encoding": "base64",\n    "filename": "steps[0].body.fileName",\n    "content_type": "steps[0].body.contentType"\n  }\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"auth")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"OAuth2 authentication configuration. If omitted, no auth token is added to requests.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Declares which query parameters are expected in the download URL.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"steps")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Ordered list of HTTP requests to execute. At least one step is required.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"response")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"How to extract the file content from the step results.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"requires_vpc")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Whether requests should be routed through the VPC proxy for IP allowlisting. Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},"false"),".")))),(0,r.kt)("h2",{id:"authentication"},"Authentication"),(0,r.kt)("p",null,"Currently, only ",(0,r.kt)("strong",{parentName:"p"},"OAuth2 Client Credentials")," is supported."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "auth": {\n    "type": "oauth2_client_credentials",\n    "token_url": "\\\\{{env.erp.token_url}}",\n    "client_id": "\\\\{{env.erp.client_id}}",\n    "client_secret": "\\\\{{env.erp.client_secret}}",\n    "scope": "openid"\n  }\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"type")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Must be ",(0,r.kt)("inlineCode",{parentName:"td"},'"oauth2_client_credentials"'))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"token_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Handlebars template for the token endpoint URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_id")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Handlebars template for the OAuth2 client ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Handlebars template for the OAuth2 client secret")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"scope")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"OAuth2 scope string (e.g., ",(0,r.kt)("inlineCode",{parentName:"td"},'"openid"'),")")))),(0,r.kt)("p",null,"All ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," fields support Handlebars templates, allowing credentials to be resolved from environment secrets at runtime. See ",(0,r.kt)("a",{parentName:"p",href:"#credentials-and-secrets"},"Credentials and Secrets"),"."),(0,r.kt)("p",null,"The acquired token is automatically added as a ",(0,r.kt)("inlineCode",{parentName:"p"},"Bearer")," token in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization")," header for all steps, unless a step explicitly sets its own ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization")," header. Tokens are cached for the duration of their validity (",(0,r.kt)("inlineCode",{parentName:"p"},"expires_in"),")."),(0,r.kt)("h2",{id:"parameters"},"Parameters"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," array declares which query parameters the proxy URL must contain. The proxy returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"400 Bad Request")," if a required parameter is missing."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "params": [\n    { "name": "tenantId", "required": true, "description": "External system tenant ID" },\n    { "name": "documentId", "required": true, "description": "External document ID" },\n    { "name": "version", "required": false, "description": "Optional document version" }\n  ]\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"name")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameter name as it appears in the query string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"required")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Whether the parameter must be present")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"description")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Human-readable description")))),(0,r.kt)("p",null,"All query parameters (including ",(0,r.kt)("inlineCode",{parentName:"p"},"integrationId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"useCaseId"),", and any custom ones) are available in the Handlebars context under ",(0,r.kt)("inlineCode",{parentName:"p"},"params"),"."),(0,r.kt)("h2",{id:"steps"},"Steps"),(0,r.kt)("p",null,"Steps define the ordered HTTP requests to make against the external system. Each step can reference the results of previous steps, enabling multi-step download flows."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "steps": [\n    {\n      "url": "\\\\{{env.erp.base_url}}/documents",\n      "method": "POST",\n      "headers": { "Content-Type": "application/json" },\n      "body": "{\\"customerId\\": \\"{{params.customerId}}\\"}",\n      "response_type": "json"\n    },\n    {\n      "url": "\\\\{{env.erp.download_url}}?fileId={{steps.0.body.fileId}}",\n      "method": "GET",\n      "response_type": "binary"\n    }\n  ]\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Handlebars template for the request URL")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"method")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},'"GET"')," or ",(0,r.kt)("inlineCode",{parentName:"td"},'"POST"'))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"headers")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Object where each value is a Handlebars template")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"body")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Handlebars template for the request body (typically used with POST)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"response_type")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},'"json"')," (parse as JSON) or ",(0,r.kt)("inlineCode",{parentName:"td"},'"binary"')," (raw bytes, returned as base64)")))),(0,r.kt)("h3",{id:"handlebars-templates"},"Handlebars Templates"),(0,r.kt)("p",null,"All string values in ",(0,r.kt)("inlineCode",{parentName:"p"},"steps")," (",(0,r.kt)("inlineCode",{parentName:"p"},"url"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"body"),", header values) and ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," fields are Handlebars templates compiled against the ",(0,r.kt)("a",{parentName:"p",href:"#template-context"},"template context")," at runtime."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\{{env.erp.base_url}}/documents/tenant/{{params.tenantId}}/doc/{{params.documentId}}/download\n")),(0,r.kt)("p",null,"Environment variable references use a leading backslash (",(0,r.kt)("inlineCode",{parentName:"p"},"\\{{ env.* }}"),") to escape them from Handlebars \u2014 they are resolved in a separate pass after Handlebars compilation. See ",(0,r.kt)("a",{parentName:"p",href:"#environment-variable-resolution"},"Environment Variable Resolution"),"."),(0,r.kt)("h3",{id:"environment-variable-resolution"},"Environment Variable Resolution"),(0,r.kt)("p",null,"Environment variables (including secrets) are resolved ",(0,r.kt)("strong",{parentName:"p"},"after")," Handlebars compilation. This is a deliberate security measure: secret values are never processed by the Handlebars template engine."),(0,r.kt)("p",null,"In Handlebars templates, env references must be ",(0,r.kt)("strong",{parentName:"p"},"escaped")," with a backslash so that Handlebars passes them through as literals:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\\{{env.erp.base_url}}/documents/{{params.documentId}}\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In JSON configuration strings, the backslash must itself be escaped: ",(0,r.kt)("inlineCode",{parentName:"p"},'"\\\\{{env.erp.base_url}}/documents/{{params.documentId}}"')))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Processing order:")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Handlebars compilation")," \u2014 ",(0,r.kt)("inlineCode",{parentName:"li"},"{{params.documentId}}")," is resolved. ",(0,r.kt)("inlineCode",{parentName:"li"},"\\{{env.erp.base_url}}")," is output as the literal text ",(0,r.kt)("inlineCode",{parentName:"li"},"{{env.erp.base_url}}"),"."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Env resolution")," \u2014 ",(0,r.kt)("inlineCode",{parentName:"li"},"{{env.erp.base_url}}")," is replaced with the actual value (e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"https://erp.example.com/api"),").")),(0,r.kt)("h3",{id:"template-context"},"Template Context"),(0,r.kt)("p",null,"The Handlebars context is an object that grows as steps execute:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "params": {\n    "orgId": "123",\n    "integrationId": "abc-123",\n    "useCaseId": "def-456",\n    "tenantId": "ACME",\n    "documentId": "DOC-00034157"\n  },\n  "steps": [\n    {\n      "body": { "fileId": "ABC123", "fileName": "invoice.pdf" },\n      "headers": { "content-type": "application/json" },\n      "statusCode": 200\n    }\n  ]\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Namespace"),(0,r.kt)("th",{parentName:"tr",align:null},"Available From"),(0,r.kt)("th",{parentName:"tr",align:null},"Contents"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params")),(0,r.kt)("td",{parentName:"tr",align:null},"All steps"),(0,r.kt)("td",{parentName:"tr",align:null},"All query parameters from the incoming request")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"steps")),(0,r.kt)("td",{parentName:"tr",align:null},"Step 2 onwards"),(0,r.kt)("td",{parentName:"tr",align:null},"Array of previous step results (body, headers, statusCode)")))),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Environment variables (",(0,r.kt)("inlineCode",{parentName:"p"},"\\{{ env.* }}"),") are resolved after Handlebars compilation in a separate pass. They are not part of this context. See ",(0,r.kt)("a",{parentName:"p",href:"#environment-variable-resolution"},"Environment Variable Resolution"),"."))),(0,r.kt)("h2",{id:"response-extraction"},"Response Extraction"),(0,r.kt)("p",null,"After all steps complete, the ",(0,r.kt)("inlineCode",{parentName:"p"},"response")," section defines how to extract the file content using ",(0,r.kt)("a",{parentName:"p",href:"https://jsonata.org/"},"JSONata")," expressions evaluated against the full context."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "body": "steps[0].body.data",\n    "encoding": "base64",\n    "filename": "steps[0].body.docInfo.originalFileName",\n    "content_type": "\'application/\' & steps[0].body.docInfo.extension"\n  }\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"body")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"JSONata expression that resolves to the file content")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"encoding")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},'"base64"')," (decode the body from base64) or ",(0,r.kt)("inlineCode",{parentName:"td"},'"binary"')," (body is already raw bytes)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"filename")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"JSONata expression that resolves to the filename string. Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},'"download"'))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"content_type")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"JSONata expression that resolves to the MIME type string. Defaults to ",(0,r.kt)("inlineCode",{parentName:"td"},'"application/octet-stream"'))))),(0,r.kt)("h3",{id:"jsonata-expressions"},"JSONata Expressions"),(0,r.kt)("p",null,"Response fields use ",(0,r.kt)("a",{parentName:"p",href:"https://jsonata.org/"},"JSONata")," \u2014 a lightweight query and transformation language for JSON. The expression is evaluated against a context containing ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"steps"),"."),(0,r.kt)("p",null,"Common patterns:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"steps[0].body.data                                    Simple path traversal\nsteps[0].body.docInfo.originalFileName                Nested property access\n'application/' & steps[0].body.docInfo.extension      String concatenation\nsteps[1].body                                         Reference a later step\nsteps[0].headers.\"content-type\"                       Access response headers\n")),(0,r.kt)("p",null,"If a JSONata expression produces a string result (e.g., for ",(0,r.kt)("inlineCode",{parentName:"p"},"filename")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"content_type"),"), any ",(0,r.kt)("inlineCode",{parentName:"p"},"{{ env.* }}")," references within the result are resolved afterwards."),(0,r.kt)("h3",{id:"response-encoding"},"Response Encoding"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Encoding"),(0,r.kt)("th",{parentName:"tr",align:null},"When to use"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"base64")),(0,r.kt)("td",{parentName:"tr",align:null},"The API returns file data as a base64-encoded string inside a JSON response. The proxy decodes it before returning.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"binary")),(0,r.kt)("td",{parentName:"tr",align:null},"The API returns the file directly as raw binary data. No decoding is needed.")))),(0,r.kt)("h2",{id:"vpc-routing"},"VPC Routing"),(0,r.kt)("p",null,"Some external systems require requests to come from known static IPs (IP allowlisting). Set ",(0,r.kt)("inlineCode",{parentName:"p"},"requires_vpc: true")," to route all HTTP requests through a VPC-deployed proxy Lambda with static outbound IPs via NAT gateway."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "requires_vpc": true,\n  "steps": [\n    {\n      "url": "\\\\{{env.erp.base_url}}/documents/{{params.documentId}}",\n      "method": "GET",\n      "response_type": "json"\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"When VPC routing is enabled:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"All step HTTP requests are forwarded to the VPC proxy Lambda"),(0,r.kt)("li",{parentName:"ul"},"The VPC proxy makes the actual outbound call from a static IP"),(0,r.kt)("li",{parentName:"ul"},"Large responses (>4.5 MB) are automatically transferred via S3")),(0,r.kt)("h2",{id:"credentials-and-secrets"},"Credentials and Secrets"),(0,r.kt)("p",null,"Auth credentials and base URLs should be stored as organization-level ",(0,r.kt)("strong",{parentName:"p"},"environment variables")," using epilot's Environments & Secrets feature. Reference them with the ",(0,r.kt)("inlineCode",{parentName:"p"},"{{ env.* }}")," syntax:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "token_url": "\\\\{{env.erp.token_url}}",\n  "client_id": "\\\\{{env.erp.client_id}}",\n  "client_secret": "\\\\{{env.erp.client_secret}}"\n}\n')),(0,r.kt)("h3",{id:"recommended-environment-variable-naming"},"Recommended Environment Variable Naming"),(0,r.kt)("p",null,"Use a prefix that identifies the external system, with dot notation for grouping:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Example Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_<system>.base_url")),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://erp.example.com/api"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_<system>.token_url")),(0,r.kt)("td",{parentName:"tr",align:null},"String"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://auth.example.com/token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_<system>.client_id")),(0,r.kt)("td",{parentName:"tr",align:null},"SecretString"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"my-client-id"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_<system>.client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},"SecretString"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"s3cr3t..."))))),(0,r.kt)("h2",{id:"proxy-url-generation"},"Proxy URL Generation"),(0,r.kt)("p",null,"During inbound sync, file entities are created with a ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_download_url")," that points to the file proxy. The URL includes the organization context, integration context, and any document-specific parameters:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://erp-file-proxy.sls.epilot.io/download?orgId=123&integrationId=abc&useCaseId=def&tenantId=ACME&documentId=DOC-00034157\n")),(0,r.kt)("p",null,"The standard parameters ",(0,r.kt)("inlineCode",{parentName:"p"},"orgId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"integrationId"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"useCaseId")," are always required. Any additional parameters (like ",(0,r.kt)("inlineCode",{parentName:"p"},"tenantId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"documentId"),") must match the ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," declared in the configuration."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"orgId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"epilot organization ID. Included in the signed URL to establish org context without requiring authentication.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"integrationId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Integration ID that owns the file proxy use case")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"useCaseId")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Yes")),(0,r.kt)("td",{parentName:"tr",align:null},"Use case ID within the integration")))),(0,r.kt)("p",null,"When a user views the file, epilot's file service adds a short-lived signature to the URL and redirects the browser. The proxy verifies this signature via the file service's ",(0,r.kt)("inlineCode",{parentName:"p"},"verifyCustomDownloadUrl")," operation."),(0,r.kt)("h3",{id:"automated-url-construction-via-inbound-mapping"},"Automated URL Construction via Inbound Mapping"),(0,r.kt)("p",null,"Instead of manually constructing ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_download_url")," values in your mapping configuration, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"file_proxy_url")," field type to auto-construct the proxy URL. The ",(0,r.kt)("inlineCode",{parentName:"p"},"orgId")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"integrationId")," parameters are injected automatically from the processing context:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "attribute": "custom_download_url",\n  "file_proxy_url": {\n    "use_case_id": "uuid-of-file-proxy-use-case",\n    "params": {\n      "documentId": { "field": "documentId" },\n      "tenantId": { "constant": "ACME" }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"This generates a URL like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"https://erp-file-proxy.sls.epilot.io/download?orgId=123&integrationId=abc&useCaseId=uuid-of-file-proxy-use-case&documentId=DOC-001&tenantId=ACME\n")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"./inbound/mapping#file-proxy-url-mapping"},"Inbound Mapping Specification")," for the full reference on parameter resolution modes."),(0,r.kt)("h2",{id:"large-file-handling"},"Large File Handling"),(0,r.kt)("p",null,"Files larger than 5 MB exceed the Lambda response payload limit. In these cases, the proxy automatically:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Uploads the file to a temporary S3 bucket"),(0,r.kt)("li",{parentName:"ol"},"Returns a ",(0,r.kt)("inlineCode",{parentName:"li"},"302 Redirect")," to a presigned S3 download URL (valid for 5 minutes)"),(0,r.kt)("li",{parentName:"ol"},"The browser follows the redirect and downloads the file directly from S3")),(0,r.kt)("p",null,"This is transparent to the user and requires no configuration. Temporary files are automatically cleaned up after 24 hours."),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("h3",{id:"single-step-base64-in-json"},"Single-Step Base64-in-JSON"),(0,r.kt)("p",null,"An external document archive returns file content as a base64-encoded string inside a JSON response."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Environment secrets:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_archive.base_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://erp.example.com/document-service"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_archive.token_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://auth.example.com/realms/documents/protocol/openid-connect/token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_archive.client_id")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"epilot-app")," (SecretString)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_archive.client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"s3cr3t...")," (SecretString)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Configuration:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "requires_vpc": true,\n  "auth": {\n    "type": "oauth2_client_credentials",\n    "token_url": "\\\\{{env.erp_archive.token_url}}",\n    "scope": "openid",\n    "client_id": "\\\\{{env.erp_archive.client_id}}",\n    "client_secret": "\\\\{{env.erp_archive.client_secret}}"\n  },\n  "params": [\n    { "name": "tenantId", "required": true, "description": "External system tenant ID" },\n    { "name": "documentId", "required": true, "description": "External document ID" }\n  ],\n  "steps": [\n    {\n      "url": "\\\\{{env.erp_archive.base_url}}/document/tenant/{{params.tenantId}}/doc/{{params.documentId}}/download",\n      "method": "GET",\n      "response_type": "json"\n    }\n  ],\n  "response": {\n    "body": "steps[0].body.data",\n    "encoding": "base64",\n    "filename": "steps[0].body.docInfo.originalFileName",\n    "content_type": "\'application/\' & steps[0].body.docInfo.extension"\n  }\n}\n')),(0,r.kt)("h3",{id:"multi-step-search--binary-download"},"Multi-Step Search + Binary Download"),(0,r.kt)("p",null,"Some document management systems require two API calls: first search for the document to get a ",(0,r.kt)("inlineCode",{parentName:"p"},"fileId"),", then download the binary file."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Environment secrets:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_dms.base_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://dms.example.com/services"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_dms.download_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://dms.example.com/services/document-download"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_dms.token_url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://dms.example.com/auth/token"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_dms.client_id")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"epilot-dms-client")," (SecretString)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"erp_dms.client_secret")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"s3cr3t...")," (SecretString)")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Configuration:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "requires_vpc": true,\n  "auth": {\n    "type": "oauth2_client_credentials",\n    "token_url": "\\\\{{env.erp_dms.token_url}}",\n    "client_id": "\\\\{{env.erp_dms.client_id}}",\n    "client_secret": "\\\\{{env.erp_dms.client_secret}}"\n  },\n  "params": [\n    { "name": "customerId", "required": true },\n    { "name": "documentType", "required": true },\n    { "name": "externalId", "required": true }\n  ],\n  "steps": [\n    {\n      "url": "\\\\{{env.erp_dms.base_url}}/document-management/documents",\n      "method": "POST",\n      "headers": { "Content-Type": "application/json" },\n      "body": "{\\"customerId\\": \\"{{params.customerId}}\\", \\"filter\\": \\"documentType=={{params.documentType}};externalId=={{params.externalId}}\\"}",\n      "response_type": "json"\n    },\n    {\n      "url": "\\\\{{env.erp_dms.download_url}}?fileId={{steps.0.body.fileId}}",\n      "method": "GET",\n      "response_type": "binary"\n    }\n  ],\n  "response": {\n    "body": "steps[1].body",\n    "encoding": "binary",\n    "filename": "steps[0].body.fileName",\n    "content_type": "steps[0].body.contentType"\n  }\n}\n')),(0,r.kt)("h3",{id:"simple-binary-download"},"Simple Binary Download"),(0,r.kt)("p",null,"A minimal configuration for an API that returns the file directly as binary with no authentication."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "params": [\n    { "name": "fileId", "required": true }\n  ],\n  "steps": [\n    {\n      "url": "https://public-cdn.example.com/files/{{params.fileId}}",\n      "method": "GET",\n      "response_type": "binary"\n    }\n  ],\n  "response": {\n    "body": "steps[0].body",\n    "encoding": "binary"\n  }\n}\n')),(0,r.kt)("p",null,"This is the simplest possible configuration: one step, no auth, no filename or content type extraction (defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"download")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"application/octet-stream"),")."),(0,r.kt)("h2",{id:"validation-rules"},"Validation Rules"),(0,r.kt)("p",null,"The following rules are enforced when creating or updating a file proxy use case:"),(0,r.kt)("h3",{id:"auth"},"Auth"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"auth.type")," must be ",(0,r.kt)("inlineCode",{parentName:"li"},'"oauth2_client_credentials"')," if auth is provided"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"auth.token_url"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"auth.client_id"),", and ",(0,r.kt)("inlineCode",{parentName:"li"},"auth.client_secret")," are required strings"),(0,r.kt)("li",{parentName:"ul"},"Handlebars templates must have balanced braces (",(0,r.kt)("inlineCode",{parentName:"li"},"{{")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"}}"),")")),(0,r.kt)("h3",{id:"params"},"Params"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"params")," must be an array if provided"),(0,r.kt)("li",{parentName:"ul"},"Each param must have a ",(0,r.kt)("inlineCode",{parentName:"li"},"name")," (non-empty string) and a ",(0,r.kt)("inlineCode",{parentName:"li"},"required")," (boolean) field")),(0,r.kt)("h3",{id:"steps-1"},"Steps"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"At least one step is required"),(0,r.kt)("li",{parentName:"ul"},"Each step must have a ",(0,r.kt)("inlineCode",{parentName:"li"},"url")," (non-empty string), ",(0,r.kt)("inlineCode",{parentName:"li"},"method")," (",(0,r.kt)("inlineCode",{parentName:"li"},'"GET"')," or ",(0,r.kt)("inlineCode",{parentName:"li"},'"POST"'),"), and ",(0,r.kt)("inlineCode",{parentName:"li"},"response_type")," (",(0,r.kt)("inlineCode",{parentName:"li"},'"json"')," or ",(0,r.kt)("inlineCode",{parentName:"li"},'"binary"'),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"body")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"headers")," values must be strings if provided"),(0,r.kt)("li",{parentName:"ul"},"Handlebars templates must have balanced braces")),(0,r.kt)("h3",{id:"response"},"Response"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"response.body")," is required and must be a valid JSONata expression"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"response.encoding")," must be ",(0,r.kt)("inlineCode",{parentName:"li"},'"base64"')," or ",(0,r.kt)("inlineCode",{parentName:"li"},'"binary"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"response.filename")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"response.content_type")," must be valid JSONata expressions if provided")),(0,r.kt)("h2",{id:"best-practices"},"Best Practices"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Use descriptive parameter names.")," Parameters become part of the proxy URL. Use clear, specific names like ",(0,r.kt)("inlineCode",{parentName:"p"},"tenantId")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"documentId"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Extract filename and content type when available.")," This gives users a better download experience instead of a generic ",(0,r.kt)("inlineCode",{parentName:"p"},"download")," filename.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Minimize the number of steps.")," Each step adds latency. If the external API supports a direct download endpoint, prefer a single-step configuration.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Store credentials as environment secrets.")," Never hard-code credentials in the configuration. Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"\\{{ env.* }}")," syntax to reference secrets stored via epilot's Environments & Secrets feature."))))}u.isMDXComponent=!0}}]);