"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[31053],{35722:(e,t,n)=>{n.d(t,{G:()=>c});var i=n(42858),r=n(67294),o=n(25108);let a=0,s=!1;const d=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",i="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??i},c=e=>{let{chart:t,config:n}=e;const c=(0,r.useRef)(null),l=(0,r.useRef)("mermaid-"+a++),[u,m]=(0,r.useState)(""),p=(0,r.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=d(e,p);s||(i.Z.initialize({startOnLoad:!1,theme:n,...p?.mermaid||{}}),s=!0);(async()=>{try{const{svg:e}=await i.Z.render(l.current,t);m(e)}catch(e){o.error("Mermaid rendering failed:",e)}})()}),[t,p]),(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const r of n){if("attributes"!==r.type||"data-theme"!==r.attributeName)continue;const n=d(e,p);s=!1,i.Z.initialize({startOnLoad:!1,theme:n,...p?.mermaid||{}}),s=!0,l.current="mermaid-"+a++,i.Z.render(l.current,t).then((e=>{let{svg:t}=e;m(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,p]),"undefined"==typeof window?r.createElement("div",{className:"mermaid"},t):r.createElement("div",{ref:c,dangerouslySetInnerHTML:{__html:u}})}},83902:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var i=n(87462),r=(n(67294),n(3905));n(35722);const o={sidebar_position:2,title:"Security"},a=void 0,s={unversionedId:"integrations/webhooks/security",id:"integrations/webhooks/security",title:"Security",description:"Always verify webhook signatures before processing payloads. Without verification, an attacker could send forged requests to your endpoint.",source:"@site/docs/integrations/webhooks/security.md",sourceDirName:"integrations/webhooks",slug:"/integrations/webhooks/security",permalink:"/docs/integrations/webhooks/security",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/integrations/webhooks/security.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Security"},sidebar:"docsSidebar",previous:{title:"JSONata Customization",permalink:"/docs/integrations/webhooks/payload-structure/customization"},next:{title:"Monitoring",permalink:"/docs/integrations/webhooks/monitoring"}},d=[{value:"Endpoint Authentication",id:"endpoint-authentication",children:[{value:"API Key",id:"api-key",children:[],level:3},{value:"Basic Auth",id:"basic-auth",children:[],level:3},{value:"OAuth",id:"oauth",children:[],level:3}],level:2},{value:"Webhook Signature Verification",id:"webhook-signature-verification",children:[],level:2},{value:"Two Signatures, Two Purposes",id:"two-signatures-two-purposes",children:[],level:2},{value:"Verification",id:"verification",children:[{value:"Option 1: Symmetric Verification (recommended for most use cases)",id:"option-1-symmetric-verification-recommended-for-most-use-cases",children:[],level:3},{value:"Option 2: Asymmetric Verification",id:"option-2-asymmetric-verification",children:[],level:3},{value:"Option 3: Verify Both",id:"option-3-verify-both",children:[],level:3}],level:2},{value:"Fetching the Public Key",id:"fetching-the-public-key",children:[],level:2},{value:"Signing Secret",id:"signing-secret",children:[],level:2}],c={toc:d},l="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(l,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Always verify webhook signatures before processing payloads. Without verification, an attacker could send forged requests to your endpoint."))),(0,r.kt)("h2",{id:"endpoint-authentication"},"Endpoint Authentication"),(0,r.kt)("p",null,"epilot supports three methods for authenticating requests to your webhook endpoint:"),(0,r.kt)("h3",{id:"api-key"},"API Key"),(0,r.kt)("p",null,"epilot sends your configured API key in the ",(0,r.kt)("inlineCode",{parentName:"p"},"X-API-Key")," header with each request. Validate this key before processing any payload."),(0,r.kt)("h3",{id:"basic-auth"},"Basic Auth"),(0,r.kt)("p",null,"epilot Base64-encodes the configured username and password and sends them in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization: Basic")," header. Always use HTTPS to prevent credential exposure."),(0,r.kt)("h3",{id:"oauth"},"OAuth"),(0,r.kt)("p",null,"epilot obtains an access token from your authorization server and sends it in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Authorization: Bearer")," header. Token expiration and refresh are handled automatically."),(0,r.kt)("h2",{id:"webhook-signature-verification"},"Webhook Signature Verification"),(0,r.kt)("p",null,"Every webhook request from epilot includes three signature headers:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Header"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhook-id")),(0,r.kt)("td",{parentName:"tr",align:null},"Unique message identifier (e.g. ",(0,r.kt)("inlineCode",{parentName:"td"},"msg_2a4f8b..."),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhook-timestamp")),(0,r.kt)("td",{parentName:"tr",align:null},"Unix timestamp (seconds) when the request was signed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"webhook-signature")),(0,r.kt)("td",{parentName:"tr",align:null},"Space-separated signatures: ",(0,r.kt)("inlineCode",{parentName:"td"},"v1a,<asymmetric> v1,<symmetric>"))))),(0,r.kt)("h2",{id:"two-signatures-two-purposes"},"Two Signatures, Two Purposes"),(0,r.kt)("p",null,"epilot sends ",(0,r.kt)("strong",{parentName:"p"},"two")," signatures with each webhook request:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"v1a"))," (asymmetric, Ed25519) \u2014 Proves the request came from your organization. Verified using your organization's public key, which is specific to your tenant and never shared across organizations."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"v1"))," (symmetric, HMAC-SHA256) \u2014 Proves the request is intended for your specific webhook. Verified using the ",(0,r.kt)("inlineCode",{parentName:"li"},"whsec_...")," signing secret you received when the webhook was created.")),(0,r.kt)("p",null,"Both signatures are computed over the same content:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="Signed content format"',title:'"Signed',content:!0,'format"':!0},"signed_content = ${webhook-id}.${webhook-timestamp}.${request_body}\n")),(0,r.kt)("h2",{id:"verification"},"Verification"),(0,r.kt)("h3",{id:"option-1-symmetric-verification-recommended-for-most-use-cases"},"Option 1: Symmetric Verification (recommended for most use cases)"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/standardwebhooks"},(0,r.kt)("inlineCode",{parentName:"a"},"standardwebhooks"))," npm package to verify the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1")," signature with your webhook's signing secret."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Symmetric verification (HMAC-SHA256)"',title:'"Symmetric',verification:!0,'(HMAC-SHA256)"':!0},'import { Webhook } from "standardwebhooks";\n\nconst signingSecret = "whsec_..."; // from webhook creation response\n\nfunction verifyWebhook(req: Request): boolean {\n  const payload = req.body; // raw request body as string\n  const headers = req.headers;\n\n  // Extract the v1 signature and convert prefix for standardwebhooks compatibility\n  const signatureHeader = headers["webhook-signature"];\n  const v1sSig = signatureHeader\n    .split(" ")[1]\n\n  if (!v1sSig) {\n    throw new Error("No symmetric signature found");\n  }\n\n  const wh = new Webhook(signingSecret);\n\n  // verify() throws if the signature is invalid or timestamp is too old\n  wh.verify(payload, {\n    "webhook-id": headers["webhook-id"],\n    "webhook-timestamp": headers["webhook-timestamp"],\n    "webhook-signature": v1sSig,\n  });\n\n  return true;\n}\n')),(0,r.kt)("h3",{id:"option-2-asymmetric-verification"},"Option 2: Asymmetric Verification"),(0,r.kt)("p",null,"Use Node.js ",(0,r.kt)("inlineCode",{parentName:"p"},"crypto")," to verify the ",(0,r.kt)("inlineCode",{parentName:"p"},"v1a")," Ed25519 signature with your organization's public key. Each tenant has their own key pair."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Asymmetric verification (Ed25519)"',title:'"Asymmetric',verification:!0,'(Ed25519)"':!0},'import crypto from "node:crypto";\n\n// Fetch your organization\'s public key (per-tenant)\n// Requires org_id query parameter\nasync function getOrgPublicKey(orgId: string): Promise<string> {\n  const response = await fetch(\n    `https://webhooks.sls.epilot.io/v1/webhooks/.well-known/public-key?orgId=${orgId}`\n  );\n  const data = await response.json();\n  return data.public_key;\n}\n\nasync function verifyAsymmetric(req: Request, orgId: string): Promise<boolean> {\n  const payload = req.body; // raw request body as string\n  const headers = req.headers;\n\n  // Fetch and cache your organization\'s public key (rarely changes)\n  // The public key is specific to your organization (org_id)\n  const orgPublicKey = await getOrgPublicKey(orgId);\n\n  const signatureHeader = headers["webhook-signature"];\n  const v1aSig = signatureHeader\n    .split(" ")\n    .find((s) => s.startsWith("v1a,"));\n\n  if (!v1aSig) {\n    throw new Error("No asymmetric signature found");\n  }\n\n  const signature = Buffer.from(v1aSig.replace("v1a,", ""), "base64");\n\n  const signedContent = `${headers["webhook-id"]}.${headers["webhook-timestamp"]}.${payload}`;\n\n  return crypto.verify(\n    null,\n    new TextEncoder().encode(signedContent),\n    orgPublicKey,\n    signature\n  );\n}\n')),(0,r.kt)("h3",{id:"option-3-verify-both"},"Option 3: Verify Both"),(0,r.kt)("p",null,"For maximum security, verify both signatures:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript",metastring:'title="Full verification (both signatures)"',title:'"Full',verification:!0,"(both":!0,'signatures)"':!0},'async function verifyWebhookFull(req: Request, orgId: string): Promise<boolean> {\n  // 1. Check timestamp freshness (reject requests older than 5 minutes)\n  const timestamp = Number(req.headers["webhook-timestamp"]);\n  const now = Math.floor(Date.now() / 1000);\n  if (Math.abs(now - timestamp) > 300) {\n    throw new Error("Webhook timestamp too old \u2014 possible replay attack");\n  }\n\n  // 2. Verify asymmetric signature (proves it came from your organization)\n  const isFromOrg = await verifyAsymmetric(req, orgId);\n  if (!isFromOrg) {\n    throw new Error("Invalid asymmetric signature");\n  }\n\n  // 3. Verify symmetric signature (proves it\'s for your webhook)\n  verifyWebhook(req); // throws on failure\n\n  return true;\n}\n')),(0,r.kt)("h2",{id:"fetching-the-public-key"},"Fetching the Public Key"),(0,r.kt)("p",null,"To fetch your organization's public key, include your organization ID as a query parameter:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Fetch your organization\'s public key"',title:'"Fetch',your:!0,"organization's":!0,public:!0,'key"':!0},'curl "https://webhooks.sls.epilot.io/v1/webhooks/.well-known/public-key?orgId=YOUR_ORG_ID"\n')),(0,r.kt)("p",null,"Response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Public key response"',title:'"Public',key:!0,'response"':!0},'{\n  "public_key": "-----BEGIN PUBLIC KEY-----\\nMCowBQYDK2VwAyEA...\\n-----END PUBLIC KEY-----\\n"\n}\n')),(0,r.kt)("p",null,"Cache this key \u2014 it's unique to your organization and rarely changes. The public key is derived from your organization's private Ed25519 key pair, which is stored encrypted and never leaves epilot's systems."),(0,r.kt)("h2",{id:"signing-secret"},"Signing Secret"),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"whsec_...")," signing secret is returned ",(0,r.kt)("strong",{parentName:"p"},"only once")," in the response when you create a webhook. Store it securely. If lost, you'll need to recreate the webhook to get a new one."))))}u.isMDXComponent=!0}}]);