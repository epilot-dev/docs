"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[17399],{35722:(e,t,n)=>{n.d(t,{G:()=>o});var i=n(42858),a=n(67294),r=n(25108);let l=0,d=!1;const s=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",i="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??i},o=e=>{let{chart:t,config:n}=e;const o=(0,a.useRef)(null),u=(0,a.useRef)("mermaid-"+l++),[m,c]=(0,a.useState)(""),p=(0,a.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,a.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=s(e,p);d||(i.Z.initialize({startOnLoad:!1,theme:n,...p?.mermaid||{}}),d=!0);(async()=>{try{const{svg:e}=await i.Z.render(u.current,t);c(e)}catch(e){r.error("Mermaid rendering failed:",e)}})()}),[t,p]),(0,a.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const a of n){if("attributes"!==a.type||"data-theme"!==a.attributeName)continue;const n=s(e,p);d=!1,i.Z.initialize({startOnLoad:!1,theme:n,...p?.mermaid||{}}),d=!0,u.current="mermaid-"+l++,i.Z.render(u.current,t).then((e=>{let{svg:t}=e;c(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,p]),"undefined"==typeof window?a.createElement("div",{className:"mermaid"},t):a.createElement("div",{ref:o,dangerouslySetInnerHTML:{__html:m}})}},11364:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>d,toc:()=>s});var i=n(87462),a=(n(67294),n(3905));n(35722);const r={sidebar_position:3,title:"Unique Identifiers",description:"Configure how entities are matched and looked up"},l="Unique Identifiers",d={unversionedId:"integrations/erp-toolkit/inbound/unique-identifiers",id:"integrations/erp-toolkit/inbound/unique-identifiers",title:"Unique Identifiers",description:"Configure how entities are matched and looked up",source:"@site/docs/integrations/erp-toolkit/inbound/unique-identifiers.md",sourceDirName:"integrations/erp-toolkit/inbound",slug:"/integrations/erp-toolkit/inbound/unique-identifiers",permalink:"/docs/integrations/erp-toolkit/inbound/unique-identifiers",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/integrations/erp-toolkit/inbound/unique-identifiers.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Unique Identifiers",description:"Configure how entities are matched and looked up"},sidebar:"docsSidebar",previous:{title:"Mapping",permalink:"/docs/integrations/erp-toolkit/inbound/mapping"},next:{title:"Relations",permalink:"/docs/integrations/erp-toolkit/inbound/relations"}},s=[{value:"Basic Usage",id:"basic-usage",children:[],level:2},{value:"Lookup Behavior",id:"lookup-behavior",children:[{value:"Single Identifier",id:"single-identifier",children:[],level:3},{value:"Multiple Identifiers (AND Logic)",id:"multiple-identifiers-and-logic",children:[],level:3},{value:"Lookup Results",id:"lookup-results",children:[],level:3}],level:2},{value:"Special Identifier Types",id:"special-identifier-types",children:[{value:"Direct Entity ID (<code>_id</code>)",id:"direct-entity-id-_id",children:[],level:3},{value:"Email Lookup",id:"email-lookup",children:[],level:3},{value:"Phone Lookup",id:"phone-lookup",children:[],level:3}],level:2},{value:"Multi-Field Composite Keys",id:"multi-field-composite-keys",children:[],level:2},{value:"Fallback Strategies",id:"fallback-strategies",children:[{value:"Primary and Secondary Identifiers",id:"primary-and-secondary-identifiers",children:[],level:3}],level:2},{value:"Identifier Requirements",id:"identifier-requirements",children:[{value:"Field Must Be Mapped",id:"field-must-be-mapped",children:[],level:3},{value:"Non-Empty Values",id:"non-empty-values",children:[],level:3}],level:2},{value:"Best Practices",id:"best-practices",children:[{value:"Choose Stable Identifiers",id:"choose-stable-identifiers",children:[],level:3},{value:"Avoid Ambiguity",id:"avoid-ambiguity",children:[],level:3},{value:"Handle Legacy Data",id:"handle-legacy-data",children:[],level:3}],level:2},{value:"Error Handling",id:"error-handling",children:[{value:"Multiple Matches",id:"multiple-matches",children:[],level:3},{value:"No Identifier Value",id:"no-identifier-value",children:[],level:3}],level:2},{value:"Next Steps",id:"next-steps",children:[],level:2}],o={toc:s},u="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,i.Z)({},o,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"unique-identifiers"},"Unique Identifiers"),(0,a.kt)("p",null,"Unique identifiers determine how the ERP Toolkit finds existing entities in epilot. When processing an event, the system searches for entities matching the specified identifiers to decide whether to create or update."),(0,a.kt)("h2",{id:"basic-usage"},"Basic Usage"),(0,a.kt)("p",null,"Specify one or more fields as unique identifiers:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contact",\n  "unique_ids": ["customer_number"],\n  "fields": [\n    { "attribute": "customer_number", "field": "customerId" },\n    { "attribute": "first_name", "field": "firstName" }\n  ]\n}\n')),(0,a.kt)("p",null,"The system extracts ",(0,a.kt)("inlineCode",{parentName:"p"},"customer_number")," from the mapped fields and searches for existing entities."),(0,a.kt)("h2",{id:"lookup-behavior"},"Lookup Behavior"),(0,a.kt)("h3",{id:"single-identifier"},"Single Identifier"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'"unique_ids": ["customer_number"]\n')),(0,a.kt)("p",null,"Searches for entities where ",(0,a.kt)("inlineCode",{parentName:"p"},"customer_number")," matches the incoming value."),(0,a.kt)("h3",{id:"multiple-identifiers-and-logic"},"Multiple Identifiers (AND Logic)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'"unique_ids": ["customer_number", "branch_code"]\n')),(0,a.kt)("p",null,"Searches for entities where ",(0,a.kt)("strong",{parentName:"p"},"both")," fields match. Useful for composite keys."),(0,a.kt)("h3",{id:"lookup-results"},"Lookup Results"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Result"),(0,a.kt)("th",{parentName:"tr",align:null},"Action"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"No match"),(0,a.kt)("td",{parentName:"tr",align:null},"Create new entity")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Single match"),(0,a.kt)("td",{parentName:"tr",align:null},"Update existing entity")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Multiple matches"),(0,a.kt)("td",{parentName:"tr",align:null},"Error - ambiguous identifier")))),(0,a.kt)("h2",{id:"special-identifier-types"},"Special Identifier Types"),(0,a.kt)("h3",{id:"direct-entity-id-_id"},"Direct Entity ID (",(0,a.kt)("inlineCode",{parentName:"h3"},"_id"),")"),(0,a.kt)("p",null,"If you know the epilot entity ID, bypass the search:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contact",\n  "unique_ids": ["_id"],\n  "fields": [\n    { "attribute": "_id", "field": "epilotEntityId" },\n    { "attribute": "first_name", "field": "firstName" }\n  ]\n}\n')),(0,a.kt)("p",null,"This directly fetches the entity without Elasticsearch search."),(0,a.kt)("h3",{id:"email-lookup"},"Email Lookup"),(0,a.kt)("p",null,"Email fields require special handling since they're stored as arrays:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contact",\n  "unique_ids": ["email"],\n  "fields": [\n    { "attribute": "email", "field": "emailAddress", "_type": "email" }\n  ]\n}\n')),(0,a.kt)("p",null,"The system automatically searches the repeatable email field structure."),(0,a.kt)("h3",{id:"phone-lookup"},"Phone Lookup"),(0,a.kt)("p",null,"Similar to email, phone fields are repeatable:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contact",\n  "unique_ids": ["phone"],\n  "fields": [\n    { "attribute": "phone", "field": "phoneNumber", "_type": "phone" }\n  ]\n}\n')),(0,a.kt)("h2",{id:"multi-field-composite-keys"},"Multi-Field Composite Keys"),(0,a.kt)("p",null,"For entities with composite business keys:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contract",\n  "unique_ids": ["contract_number", "contract_type"],\n  "fields": [\n    { "attribute": "contract_number", "field": "contractId" },\n    { "attribute": "contract_type", "field": "type" },\n    { "attribute": "start_date", "field": "startDate" }\n  ]\n}\n')),(0,a.kt)("p",null,"Both ",(0,a.kt)("inlineCode",{parentName:"p"},"contract_number")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"contract_type")," must match for an entity to be found."),(0,a.kt)("h2",{id:"fallback-strategies"},"Fallback Strategies"),(0,a.kt)("h3",{id:"primary-and-secondary-identifiers"},"Primary and Secondary Identifiers"),(0,a.kt)("p",null,"Process entities with different identifier strategies:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entities": [\n    {\n      "entity_schema": "contact",\n      "unique_ids": ["customer_number"],\n      "enabled": "$exists(customerId)",\n      "fields": [\n        { "attribute": "customer_number", "field": "customerId" }\n      ]\n    },\n    {\n      "entity_schema": "contact",\n      "unique_ids": ["email"],\n      "enabled": "$not($exists(customerId)) and $exists(email)",\n      "fields": [\n        { "attribute": "email", "field": "email", "_type": "email" }\n      ]\n    }\n  ]\n}\n')),(0,a.kt)("p",null,"This first tries to match by ",(0,a.kt)("inlineCode",{parentName:"p"},"customer_number"),", falling back to ",(0,a.kt)("inlineCode",{parentName:"p"},"email")," if not available."),(0,a.kt)("h2",{id:"identifier-requirements"},"Identifier Requirements"),(0,a.kt)("h3",{id:"field-must-be-mapped"},"Field Must Be Mapped"),(0,a.kt)("p",null,"The identifier field must be included in the ",(0,a.kt)("inlineCode",{parentName:"p"},"fields")," array:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// Correct\n{\n  "unique_ids": ["customer_number"],\n  "fields": [\n    { "attribute": "customer_number", "field": "customerId" }  // Required\n  ]\n}\n\n// Incorrect - will fail\n{\n  "unique_ids": ["customer_number"],\n  "fields": [\n    { "attribute": "first_name", "field": "firstName" }\n    // customer_number not mapped!\n  ]\n}\n')),(0,a.kt)("h3",{id:"non-empty-values"},"Non-Empty Values"),(0,a.kt)("p",null,"Identifier fields must have non-empty values. Empty or null values cause lookup failures:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// Add validation\n{\n  "attribute": "customer_number",\n  "field": "customerId",\n  "enabled": "$exists(customerId) and customerId != \'\'"\n}\n')),(0,a.kt)("h2",{id:"best-practices"},"Best Practices"),(0,a.kt)("h3",{id:"choose-stable-identifiers"},"Choose Stable Identifiers"),(0,a.kt)("p",null,"Use business keys that don't change over time:"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Good"),(0,a.kt)("th",{parentName:"tr",align:null},"Avoid"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Customer number"),(0,a.kt)("td",{parentName:"tr",align:null},"Email address")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Contract ID"),(0,a.kt)("td",{parentName:"tr",align:null},"Phone number")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Meter serial number"),(0,a.kt)("td",{parentName:"tr",align:null},"Name")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"External system ID"),(0,a.kt)("td",{parentName:"tr",align:null},"Address")))),(0,a.kt)("h3",{id:"avoid-ambiguity"},"Avoid Ambiguity"),(0,a.kt)("p",null,"Ensure your identifiers uniquely identify entities:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'// Too broad - may match multiple entities\n"unique_ids": ["last_name"]\n\n// Better - unique business identifier\n"unique_ids": ["customer_number"]\n\n// Best - composite key for guaranteed uniqueness\n"unique_ids": ["customer_number", "branch_code"]\n')),(0,a.kt)("h3",{id:"handle-legacy-data"},"Handle Legacy Data"),(0,a.kt)("p",null,"When migrating data, include both old and new identifiers:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "entity_schema": "contact",\n  "unique_ids": ["new_customer_id"],\n  "fields": [\n    { "attribute": "new_customer_id", "field": "newId" },\n    { "attribute": "legacy_id", "field": "oldId" }\n  ]\n}\n')),(0,a.kt)("h2",{id:"error-handling"},"Error Handling"),(0,a.kt)("h3",{id:"multiple-matches"},"Multiple Matches"),(0,a.kt)("p",null,"When multiple entities match the identifier:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Multiple entities found for unique identifier",\n  "error": {\n    "code": "AMBIGUOUS_IDENTIFIER",\n    "category": "validation"\n  }\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Resolution:")," Use more specific identifiers or clean up duplicate data."),(0,a.kt)("h3",{id:"no-identifier-value"},"No Identifier Value"),(0,a.kt)("p",null,"When the identifier field is empty:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": "error",\n  "message": "Required unique identifier field is empty",\n  "error": {\n    "code": "MISSING_IDENTIFIER",\n    "category": "validation"\n  }\n}\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Resolution:")," Ensure source data includes the identifier value."),(0,a.kt)("h2",{id:"next-steps"},"Next Steps"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./relations"},"Relations")," - Link entities together"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./meter-readings"},"Meter Readings")," - Handle meter reading data"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./examples"},"Examples")," - Complete integration examples")))}m.isMDXComponent=!0}}]);