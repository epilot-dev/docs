"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[27815],{35722:(t,e,a)=>{a.d(e,{G:()=>d});var n=a(42858),r=a(67294),i=a(25108);let l=0,s=!1;const o=(t,e)=>{const a=t?.getAttribute("data-theme")??"light",n="dark"===a?"dark":"default";return e?.theme?.[a]??e?.mermaid?.theme??n},d=t=>{let{chart:e,config:a}=t;const d=(0,r.useRef)(null),p=(0,r.useRef)("mermaid-"+l++),[u,m]=(0,r.useState)(""),k=(0,r.useMemo)((()=>"string"==typeof a?JSON.parse(a):a),[a]);return(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const t=document.querySelector("html"),a=o(t,k);s||(n.Z.initialize({startOnLoad:!1,theme:a,...k?.mermaid||{}}),s=!0);(async()=>{try{const{svg:t}=await n.Z.render(p.current,e);m(t)}catch(t){i.error("Mermaid rendering failed:",t)}})()}),[e,k]),(0,r.useEffect)((()=>{if("undefined"==typeof window)return;const t=document.querySelector("html"),a=new MutationObserver((a=>{for(const r of a){if("attributes"!==r.type||"data-theme"!==r.attributeName)continue;const a=o(t,k);s=!1,n.Z.initialize({startOnLoad:!1,theme:a,...k?.mermaid||{}}),s=!0,p.current="mermaid-"+l++,n.Z.render(p.current,e).then((t=>{let{svg:e}=t;m(e)}));break}}));return a.observe(t,{attributes:!0}),()=>a.disconnect()}),[e,k]),"undefined"==typeof window?r.createElement("div",{className:"mermaid"},e):r.createElement("div",{ref:d,dangerouslySetInnerHTML:{__html:u}})}},49455:(t,e,a)=>{a.r(e),a.d(e,{contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var n=a(87462),r=(a(67294),a(3905)),i=a(35722);const l={sidebar_position:4,title:"Batch API"},s="Batch API",o={unversionedId:"integrations/batch-api",id:"integrations/batch-api",title:"Batch API",description:"[API Docs]",source:"@site/docs/integrations/batch-api.md",sourceDirName:"integrations",slug:"/integrations/batch-api",permalink:"/docs/integrations/batch-api",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/integrations/batch-api.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Batch API"},sidebar:"docsSidebar",previous:{title:"Mapping Examples",permalink:"/docs/integrations/erp-toolkit/mapping-examples"},next:{title:"Rate Limits",permalink:"/docs/integrations/rate-limits"}},d=[{value:"How It Works",id:"how-it-works",children:[],level:2},{value:"Request Format",id:"request-format",children:[{value:"Supported Methods",id:"supported-methods",children:[],level:3},{value:"Request Properties",id:"request-properties",children:[],level:3}],level:2},{value:"Response Format",id:"response-format",children:[],level:2},{value:"Ordering",id:"ordering",children:[],level:2},{value:"Limits",id:"limits",children:[],level:2},{value:"Error Handling",id:"error-handling",children:[],level:2},{value:"When to Use",id:"when-to-use",children:[],level:2}],p={toc:d},u="wrapper";function m(t){let{components:e,...a}=t;return(0,r.kt)(u,(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"batch-api"},"Batch API"),(0,r.kt)("p",null,"[",(0,r.kt)("a",{parentName:"p",href:"/api/batch"},"API Docs"),"]"),(0,r.kt)("p",null,"The Batch API allows you to execute multiple epilot API calls in a single HTTP request. Instead of making 50 individual API calls, submit them as one batch and retrieve the results asynchronously."),(0,r.kt)("p",null,"This is particularly useful for middleware platforms (e.g., SAP CPI) where each HTTP request counts against message quotas."),(0,r.kt)("h2",{id:"how-it-works"},"How It Works"),(0,r.kt)(i.G,{chart:"sequenceDiagram\n    participant Client\n    participant Batch as Batch API\n    participant Queue as SQS FIFO\n    participant Worker as Batch Worker\n    participant APIs as epilot APIs\n\n    Client->>Batch: POST /v1/batch/jobs\n    Batch--\x3e>Client: 202 { job_id }\n    Batch->>Queue: Enqueue requests\n    Queue->>Worker: Process batch\n    Worker->>APIs: Execute requests\n    Worker->>Worker: Store results\n    Client->>Batch: GET /v1/batch/jobs/{job_id}\n    Batch--\x3e>Client: 200 { tasks with responses }",mdxType:"Mermaid"}),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Submit")," a batch of requests to ",(0,r.kt)("inlineCode",{parentName:"li"},"POST /v1/batch/jobs")," -- returns a ",(0,r.kt)("inlineCode",{parentName:"li"},"job_id")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Poll")," ",(0,r.kt)("inlineCode",{parentName:"li"},"GET /v1/batch/jobs/{job_id}")," to retrieve results as tasks complete"),(0,r.kt)("li",{parentName:"ol"},"Each task includes the original request and its HTTP response")),(0,r.kt)("h2",{id:"request-format"},"Request Format"),(0,r.kt)("p",null,"A batch job contains requests grouped by HTTP method. All requests target epilot API endpoints."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="POST /v1/batch/jobs"',title:'"POST','/v1/batch/jobs"':!0},'{\n  "defaults": {\n    "headers": {\n      "authorization": "Bearer <token>"\n    }\n  },\n  "PatchRequests": [\n    {\n      "request_id": "update-contact-1",\n      "url": "https://entity.sls.epilot.io/v1/entity/contact:upsert",\n      "body": {\n        "unique_key": ["email.0.email"],\n        "entity": {\n          "_schema": "contact",\n          "first_name": "Jane",\n          "last_name": "Doe",\n          "email": [{ "email": "jane@example.com" }]\n        }\n      }\n    },\n    {\n      "request_id": "update-contact-2",\n      "url": "https://entity.sls.epilot.io/v1/entity/contact:upsert",\n      "body": {\n        "unique_key": ["email.0.email"],\n        "entity": {\n          "_schema": "contact",\n          "first_name": "John",\n          "last_name": "Smith",\n          "email": [{ "email": "john@example.com" }]\n        }\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"supported-methods"},"Supported Methods"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Field"),(0,r.kt)("th",{parentName:"tr",align:null},"HTTP Method"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"GetRequests")),(0,r.kt)("td",{parentName:"tr",align:null},"GET")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PostRequests")),(0,r.kt)("td",{parentName:"tr",align:null},"POST")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PutRequests")),(0,r.kt)("td",{parentName:"tr",align:null},"PUT")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"PatchRequests")),(0,r.kt)("td",{parentName:"tr",align:null},"PATCH")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"DeleteRequests")),(0,r.kt)("td",{parentName:"tr",align:null},"DELETE")))),(0,r.kt)("h3",{id:"request-properties"},"Request Properties"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"url")),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Full URL to an epilot API endpoint")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"body")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Request payload (for POST, PUT, PATCH)")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"headers")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Per-request headers (merged with ",(0,r.kt)("inlineCode",{parentName:"td"},"defaults.headers"),")")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"request_id")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Custom identifier for tracking individual requests in the response")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"group_id")),(0,r.kt)("td",{parentName:"tr",align:null},"No"),(0,r.kt)("td",{parentName:"tr",align:null},"Sequential processing group (see ",(0,r.kt)("a",{parentName:"td",href:"#ordering"},"Ordering")," below)")))),(0,r.kt)("h2",{id:"response-format"},"Response Format"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="GET /v1/batch/jobs/{job_id}"',title:'"GET','/v1/batch/jobs/{job_id}"':!0},'{\n  "job_id": "abc-123",\n  "job_status": "pending",\n  "created_at": "2025-06-15T10:30:00Z",\n  "PatchTasks": [\n    {\n      "task_id": "task-1",\n      "task_status": "finished",\n      "request": {\n        "request_id": "update-contact-1",\n        "url": "https://entity.sls.epilot.io/v1/entity/contact:upsert"\n      },\n      "response": {\n        "status": 200,\n        "body": { "entity": { "_id": "abc", "_schema": "contact" } }\n      }\n    },\n    {\n      "task_id": "task-2",\n      "task_status": "in_progress",\n      "request": {\n        "request_id": "update-contact-2",\n        "url": "https://entity.sls.epilot.io/v1/entity/contact:upsert"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"Task statuses: ",(0,r.kt)("inlineCode",{parentName:"p"},"pending")," | ",(0,r.kt)("inlineCode",{parentName:"p"},"in_progress")," | ",(0,r.kt)("inlineCode",{parentName:"p"},"finished")),(0,r.kt)("h2",{id:"ordering"},"Ordering"),(0,r.kt)("p",null,"By default, requests within a batch execute ",(0,r.kt)("strong",{parentName:"p"},"in parallel")," (up to 10 concurrently). When order matters, use ",(0,r.kt)("inlineCode",{parentName:"p"},"group_id")," to enforce sequential processing within a group."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Sequential meter readings with group_id"',title:'"Sequential',meter:!0,readings:!0,with:!0,'group_id"':!0},'{\n  "PostRequests": [\n    {\n      "group_id": "meter-001",\n      "url": "https://entity.sls.epilot.io/v1/entity/meter_reading",\n      "body": { "entity": { "reading_date": "2025-01-01", "value": 1000 } }\n    },\n    {\n      "group_id": "meter-001",\n      "url": "https://entity.sls.epilot.io/v1/entity/meter_reading",\n      "body": { "entity": { "reading_date": "2025-02-01", "value": 1250 } }\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"Requests sharing the same ",(0,r.kt)("inlineCode",{parentName:"p"},"group_id")," execute in order. Different groups run in parallel."),(0,r.kt)("h2",{id:"limits"},"Limits"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Constraint"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Max requests per batch"),(0,r.kt)("td",{parentName:"tr",align:null},"100")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Max payload size"),(0,r.kt)("td",{parentName:"tr",align:null},"6 MB")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Per-request timeout"),(0,r.kt)("td",{parentName:"tr",align:null},"30 seconds")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Parallel execution"),(0,r.kt)("td",{parentName:"tr",align:null},"Up to 10 concurrent requests")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Job data retention"),(0,r.kt)("td",{parentName:"tr",align:null},"30 days")))),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Only epilot API endpoints (",(0,r.kt)("inlineCode",{parentName:"p"},"*.sls.epilot.io"),") are accepted. Requests to external URLs are rejected."))),(0,r.kt)("h2",{id:"error-handling"},"Error Handling"),(0,r.kt)("p",null,"Individual request failures do not affect other requests in the batch. Each task's response contains the HTTP status and body from the target API, including error responses."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Scenario"),(0,r.kt)("th",{parentName:"tr",align:null},"Behavior"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Request succeeds"),(0,r.kt)("td",{parentName:"tr",align:null},"Task status ",(0,r.kt)("inlineCode",{parentName:"td"},"finished"),", response contains result")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Request fails (4xx/5xx)"),(0,r.kt)("td",{parentName:"tr",align:null},"Task status ",(0,r.kt)("inlineCode",{parentName:"td"},"finished"),", response contains error")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Request times out"),(0,r.kt)("td",{parentName:"tr",align:null},"Task status ",(0,r.kt)("inlineCode",{parentName:"td"},"finished"),", response contains 504")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Invalid URL"),(0,r.kt)("td",{parentName:"tr",align:null},"Batch rejected with 400 before processing")))),(0,r.kt)("p",null,"Failed tasks are retried up to 3 times before being marked as permanently failed."),(0,r.kt)("h2",{id:"when-to-use"},"When to Use"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Scenario"),(0,r.kt)("th",{parentName:"tr",align:null},"Recommended approach"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Bulk entity upserts from middleware"),(0,r.kt)("td",{parentName:"tr",align:null},"Batch API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Real-time ERP sync with mapping"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/integrations/erp-toolkit/overview"},"ERP Toolkit"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Single API call"),(0,r.kt)("td",{parentName:"tr",align:null},"Direct API")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Event-driven notifications"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/docs/integrations/webhooks"},"Webhooks"))))))}m.isMDXComponent=!0}}]);