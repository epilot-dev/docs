"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[68497],{35722:(e,t,n)=>{n.d(t,{G:()=>m});var a=n(42858),l=n(67294),i=n(25108);let r=0,o=!1;const s=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??a},m=e=>{let{chart:t,config:n}=e;const m=(0,l.useRef)(null),p=(0,l.useRef)("mermaid-"+r++),[d,c]=(0,l.useState)(""),u=(0,l.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,l.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=s(e,u);o||(a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),o=!0);(async()=>{try{const{svg:e}=await a.Z.render(p.current,t);c(e)}catch(e){i.error("Mermaid rendering failed:",e)}})()}),[t,u]),(0,l.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const l of n){if("attributes"!==l.type||"data-theme"!==l.attributeName)continue;const n=s(e,u);o=!1,a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),o=!0,p.current="mermaid-"+r++,a.Z.render(p.current,t).then((e=>{let{svg:t}=e;c(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,u]),"undefined"==typeof window?l.createElement("div",{className:"mermaid"},t):l.createElement("div",{ref:m,dangerouslySetInnerHTML:{__html:d}})}},7069:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>m});var a=n(87462),l=(n(67294),n(3905)),i=n(35722);const r={sidebar_position:3},o="Document Generation",s={unversionedId:"files/document-generation",id:"files/document-generation",title:"Document Generation",description:"[API Docs]",source:"@site/docs/files/document-generation.md",sourceDirName:"files",slug:"/files/document-generation",permalink:"/docs/files/document-generation",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/files/document-generation.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"File API",permalink:"/docs/files/file-api"},next:{title:"File Collections",permalink:"/docs/files/file-collections"}},m=[{value:"Overview",id:"overview",children:[],level:2},{value:"API Endpoints",id:"api-endpoints",children:[{value:"Extract Template Metadata",id:"extract-template-metadata",children:[],level:3},{value:"Generate Documents",id:"generate-documents",children:[],level:3},{value:"Convert Documents",id:"convert-documents",children:[],level:3}],level:2},{value:"Template Variables",id:"template-variables",children:[{value:"Basic Variable Syntax",id:"basic-variable-syntax",children:[],level:3},{value:"Variable Resolution Order",id:"variable-resolution-order",children:[],level:3},{value:"Complex Variable Examples",id:"complex-variable-examples",children:[],level:3}],level:2},{value:"Image Variables",id:"image-variables",children:[{value:"Basic Image Syntax",id:"basic-image-syntax",children:[{value:"Direct Image URL",id:"direct-image-url",children:[],level:4},{value:"Image with Size Control",id:"image-with-size-control",children:[],level:4}],level:3},{value:"Image Loops and Collections",id:"image-loops-and-collections",children:[{value:"Mapping Journey Submissions to File Attributes",id:"mapping-journey-submissions-to-file-attributes",children:[],level:4},{value:"Basic Image Loop",id:"basic-image-loop",children:[],level:4},{value:"Filtered Image Loop by Label",id:"filtered-image-loop-by-label",children:[],level:4},{value:"Complete Example with Formatting",id:"complete-example-with-formatting",children:[],level:4}],level:3},{value:"Automatic Public URL Generation",id:"automatic-public-url-generation",children:[],level:3}],level:2},{value:"Excel Generation",id:"excel-generation",children:[{value:"Excel Template Support",id:"excel-template-support",children:[],level:3},{value:"Excel Variable Syntax",id:"excel-variable-syntax",children:[{value:"Cell Variables",id:"cell-variables",children:[],level:4},{value:"Images in Excel",id:"images-in-excel",children:[],level:4}],level:3},{value:"Excel Generation Example",id:"excel-generation-example",children:[],level:3}],level:2},{value:"Troubleshooting",id:"troubleshooting",children:[],level:2},{value:"Code Examples",id:"code-examples",children:[{value:"cURL",id:"curl",children:[],level:3},{value:"Template Settings",id:"template-settings",children:[],level:3},{value:"Async Job Tracking",id:"async-job-tracking",children:[],level:3}],level:2}],p={toc:m},d="wrapper";function c(e){let{components:t,...n}=e;return(0,l.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"document-generation"},"Document Generation"),(0,l.kt)("p",null,"[",(0,l.kt)("a",{parentName:"p",href:"/api/document"},"API Docs"),"]\n[",(0,l.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@epilot/document-client"},"SDK"),"]"),(0,l.kt)("h2",{id:"overview"},"Overview"),(0,l.kt)("p",null,"The Document Generation API creates documents from templates with dynamic variable substitution. It supports multiple input and output formats, image embedding, Excel generation, and async processing with job tracking."),(0,l.kt)(i.G,{chart:"flowchart LR\n    Template[Template\\n.docx / .xlsx] --\x3e API[Document API]\n    Entity[Entity Data] --\x3e API\n    Variables[Variable Payload] --\x3e API\n    API --\x3e PDF[PDF Output]\n    API --\x3e DOCX[DOCX Output]",mdxType:"Mermaid"}),(0,l.kt)("h2",{id:"api-endpoints"},"API Endpoints"),(0,l.kt)("h3",{id:"extract-template-metadata"},"Extract Template Metadata"),(0,l.kt)("p",null,"Extract metadata and variables from document templates."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,l.kt)("inlineCode",{parentName:"p"},"POST /v2/documents:meta")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Supported formats:")," ",(0,l.kt)("inlineCode",{parentName:"p"},".docx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".doc"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xlsx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xls"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xlsm")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Request"',title:'"Request"'},'{\n  "template_document": {\n    "s3ref": {\n      "bucket": "epilot-files-prod",\n      "key": "123/templates/contract-template.docx"\n    }\n  }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response"',title:'"Response"'},'{\n  "page_margins": {\n    "top": 1440,\n    "bottom": 1440,\n    "left": 1440,\n    "right": 1440,\n    "header": 720,\n    "footer": 720\n  },\n  "variables": [\n    "customer_name",\n    "order.billing_contact.0.salutation",\n    "items[0].description",\n    "opportunities[Primary].value"\n  ]\n}\n')),(0,l.kt)("h3",{id:"generate-documents"},"Generate Documents"),(0,l.kt)("p",null,"Generate documents from templates with variable substitution."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,l.kt)("inlineCode",{parentName:"p"},"POST /v2/documents:generate")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Input formats:")," ",(0,l.kt)("inlineCode",{parentName:"p"},".docx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xlsx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xls"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xlsm"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".ics")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Output formats:")," ",(0,l.kt)("inlineCode",{parentName:"p"},".pdf"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".docx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".xlsx"),", ",(0,l.kt)("inlineCode",{parentName:"p"},".ics")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Query parameters:")),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,l.kt)("th",{parentName:"tr",align:null},"Values"),(0,l.kt)("th",{parentName:"tr",align:null},"Default"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"job_id")),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"--"),(0,l.kt)("td",{parentName:"tr",align:null},"Track async generation status")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"mode")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"partial_generation"),", ",(0,l.kt)("inlineCode",{parentName:"td"},"full_generation")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"full_generation")),(0,l.kt)("td",{parentName:"tr",align:null},"Generation flow type")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"preview_mode")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"open"),", ",(0,l.kt)("inlineCode",{parentName:"td"},"download")),(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("inlineCode",{parentName:"td"},"open")),(0,l.kt)("td",{parentName:"tr",align:null},"Preview behavior")))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Request"',title:'"Request"'},'{\n  "template_document": {\n    "s3ref": {\n      "bucket": "epilot-files-prod",\n      "key": "123/templates/invoice-template.docx"\n    },\n    "filename": "invoice-template.docx"\n  },\n  "context_entity_id": "550e8400-e29b-41d4-a716-446655440000",\n  "user_id": "user_123",\n  "language": "en",\n  "variable_payload": {\n    "custom_field": "Override value",\n    "discount": 15\n  },\n  "template_settings": {\n    "top_margin": 1440,\n    "bottom_margin": 1440,\n    "show_guidelines": false\n  }\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response"',title:'"Response"'},'{\n  "job_id": "job_550e8400",\n  "job_status": "SUCCESS",\n  "pdf": {\n    "s3ref": {\n      "bucket": "epilot-generated-documents",\n      "key": "123/output/invoice.pdf"\n    },\n    "preview_url": "https://s3.amazonaws.com/...",\n    "filename": "invoice.pdf"\n  },\n  "docx": {\n    "s3ref": {\n      "bucket": "epilot-generated-documents",\n      "key": "123/output/invoice.docx"\n    },\n    "preview_url": "https://s3.amazonaws.com/...",\n    "filename": "invoice.docx"\n  },\n  "variable_payload": {\n    "customer_name": "John Doe",\n    "custom_field": "Override value",\n    "discount": 15\n  }\n}\n')),(0,l.kt)("h3",{id:"convert-documents"},"Convert Documents"),(0,l.kt)("p",null,"Convert documents between formats (currently DOCX to PDF)."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Endpoint:")," ",(0,l.kt)("inlineCode",{parentName:"p"},"POST /v2/documents:convert")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Request"',title:'"Request"'},'{\n  "input_document": {\n    "s3ref": {\n      "bucket": "epilot-files-prod",\n      "key": "123/documents/contract.docx"\n    }\n  },\n  "output_format": "pdf",\n  "output_filename": "contract-converted.pdf",\n  "language": "en"\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="Response"',title:'"Response"'},'{\n  "output_document": {\n    "s3ref": {\n      "bucket": "epilot-generated-documents",\n      "key": "123/converted/contract-converted.pdf"\n    },\n    "preview_url": "https://s3.amazonaws.com/...",\n    "filename": "contract-converted.pdf"\n  }\n}\n')),(0,l.kt)("h2",{id:"template-variables"},"Template Variables"),(0,l.kt)("h3",{id:"basic-variable-syntax"},"Basic Variable Syntax"),(0,l.kt)("p",null,"Templates use double curly braces for variable substitution:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{{variable_name}}              // Simple variable\n{{customer.name}}               // Nested object\n{{address.street.number}}       // Deep nesting\n{{items.0.price}}              // Alternative array syntax\n{{opportunities[Primary].value}} // Label-lookup array access\n{{data["special-key"]}}        // Bracket notation for special characters on Label Lookups\n')),(0,l.kt)("h3",{id:"variable-resolution-order"},"Variable Resolution Order"),(0,l.kt)("p",null,"Variables resolve in this precedence order (highest first):"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"variable_payload")," -- explicitly provided values"),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"context_data")," -- additional context data"),(0,l.kt)("li",{parentName:"ol"},"Entity attributes from ",(0,l.kt)("inlineCode",{parentName:"li"},"context_entity_id")),(0,l.kt)("li",{parentName:"ol"},"User preferences (language) from ",(0,l.kt)("inlineCode",{parentName:"li"},"user_id"))),(0,l.kt)("h3",{id:"complex-variable-examples"},"Complex Variable Examples"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'// Customer information\n{{customer.first_name}} {{customer.last_name}}\n{{customer.address.0.street}}\n{{customer.contacts[billing].email}}\n\n// Order details with calculations\n{{ calc "ROUND((price * qty) * (1 - discount), 2)" }}\n{{order.total_amount}}\n\n// Conditional display (in supported templates)\n{{#has_discount}}\n  Discount: {{discount_percentage}}%\n{{/has_discount}}\n')),(0,l.kt)("p",null,"You can find more examples about calculation variables ",(0,l.kt)("a",{parentName:"p",href:"https://docs.epilot.io/docs/templates/template-variables#excel-like-formulas"},"here"),"."),(0,l.kt)("h2",{id:"image-variables"},"Image Variables"),(0,l.kt)("h3",{id:"basic-image-syntax"},"Basic Image Syntax"),(0,l.kt)("p",null,"Images can be embedded in documents using the special syntax:"),(0,l.kt)("h4",{id:"direct-image-url"},"Direct Image URL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{{% image_url }}\n")),(0,l.kt)("p",null,"This renders the image at its original size."),(0,l.kt)("h4",{id:"image-with-size-control"},"Image with Size Control"),(0,l.kt)("p",null,"Use an image placeholder in your template and set the variable in the alt text:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Insert an image placeholder in your Word/Excel template"),(0,l.kt)("li",{parentName:"ol"},"Set the alt text to: ",(0,l.kt)("inlineCode",{parentName:"li"},"{{% image_url }}")),(0,l.kt)("li",{parentName:"ol"},"The placeholder image dimensions will control the rendered size")),(0,l.kt)("h3",{id:"image-loops-and-collections"},"Image Loops and Collections"),(0,l.kt)("div",{style:{display:"flex",gap:"20px",marginBottom:"20px",alignItems:"center"}},(0,l.kt)("img",{src:"/img/docgen/docgen-images-p-1.png",alt:"Document Generation Images Example 1",style:{maxWidth:"50%",width:"100%"}}),(0,l.kt)("img",{src:"/img/docgen/docgen-images-p-2.png",alt:"Document Generation Images Example 2",style:{maxWidth:"50%",width:"100%"}})),(0,l.kt)("h4",{id:"mapping-journey-submissions-to-file-attributes"},"Mapping Journey Submissions to File Attributes"),(0,l.kt)("p",null,"Since the global ",(0,l.kt)("inlineCode",{parentName:"p"},"_files")," attribute is not yet supported, you need to map Journey submission fields to file attributes. For example, map a journey field to ",(0,l.kt)("inlineCode",{parentName:"p"},"my_journey_images"),"."),(0,l.kt)("h4",{id:"basic-image-loop"},"Basic Image Loop"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{{#my_journey_images[*]}}\n    {{% public_url }}\n{{/my_journey_images[*]}}\n")),(0,l.kt)("p",null,"This iterates through all images in the collection."),(0,l.kt)("h4",{id:"filtered-image-loop-by-label"},"Filtered Image Loop by Label"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{{#my_journey_images[...solar-panel]}}\n    {{% public_url }}\n{{/my_journey_images[...solar-panel]}}\n")),(0,l.kt)("p",null,'This only includes images with the label "solar-panel".'),(0,l.kt)("h4",{id:"complete-example-with-formatting"},"Complete Example with Formatting"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"{{#property_images[*]}}\n    Property Image:\n    {{% public_url }}\n\n    Description: {{ _title }}\n    Uploaded: {{ _created_at }}\n{{/property_images[*]}}\n")),(0,l.kt)("h3",{id:"automatic-public-url-generation"},"Automatic Public URL Generation"),(0,l.kt)("p",null,"The service automatically handles private images by converting them to signed URLs with temporary access credentials. These URLs expire shortly after document processing completes."),(0,l.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},(0,l.kt)("strong",{parentName:"p"},"Order tables with margin corrections are incompatible with loops.")," Templates using ",(0,l.kt)("inlineCode",{parentName:"p"},"{{~order_table mt=2 mb=2}}")," cannot include image loops or any ",(0,l.kt)("inlineCode",{parentName:"p"},"FOR_LOOP")," constructs. Remove margin correction variables and adjust margins directly in Word's built-in settings instead."))),(0,l.kt)("h2",{id:"excel-generation"},"Excel Generation"),(0,l.kt)("div",{style:{display:"flex",gap:"20px",marginBottom:"20px",alignItems:"center"}},(0,l.kt)("img",{src:"/img/docgen/docgen-excel-1.png",alt:"Excel Document Generation Example 1",style:{maxWidth:"50%",width:"100%"}}),(0,l.kt)("img",{src:"/img/docgen/docgen-excel.png",alt:"Excel Document Generation Example 2",style:{maxWidth:"50%",width:"100%"}})),(0,l.kt)("h3",{id:"excel-template-support"},"Excel Template Support"),(0,l.kt)("p",null,"The Document Generation API supports Excel templates with:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Variable substitution in cells"),(0,l.kt)("li",{parentName:"ul"},"Formula preservation (recalculation is not supported due to Excel's security model)"),(0,l.kt)("li",{parentName:"ul"},"Image embedding in spreadsheets")),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Order Table variables are not supported in Excel templates due to Excel's limitations with direct HTML rendering."))),(0,l.kt)("h3",{id:"excel-variable-syntax"},"Excel Variable Syntax"),(0,l.kt)("h4",{id:"cell-variables"},"Cell Variables"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"A1: {{customer_name}}\nB1: {{order_date}}\n")),(0,l.kt)("h4",{id:"images-in-excel"},"Images in Excel"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Cell A1: {{% product_image }}\nCell B2: {{% chart_url }}\n")),(0,l.kt)("h3",{id:"excel-generation-example"},"Excel Generation Example"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Request:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "template_document": {\n    "s3ref": {\n      "bucket": "epilot-files-prod",\n      "key": "templates/report-template.xlsx"\n    }\n  },\n  "context_entity_id": "550e8400-e29b-41d4",\n  "variable_payload": {\n    "report_title": "Q4 Sales Report",\n    "sales_data": [\n      {"month": "October", "revenue": 125000},\n      {"month": "November", "revenue": 145000},\n      {"month": "December", "revenue": 168000}\n    ],\n    "chart_image": "https://charts.example.com/q4-sales.png"\n  }\n}\n')),(0,l.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Variables not replaced"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Verify ",(0,l.kt)("inlineCode",{parentName:"li"},"{{}}")," bracket syntax"),(0,l.kt)("li",{parentName:"ul"},"Check that the variable exists in the payload or entity"),(0,l.kt)("li",{parentName:"ul"},"Remember that ",(0,l.kt)("inlineCode",{parentName:"li"},"variable_payload")," overrides entity data"))),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Image not rendering"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Use ",(0,l.kt)("inlineCode",{parentName:"li"},"{{% url }}")," with the correct syntax"),(0,l.kt)("li",{parentName:"ul"},"Confirm the image URL is accessible"),(0,l.kt)("li",{parentName:"ul"},"When using label filters, verify images have the correct labels"))),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Loop syntax errors"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Use ",(0,l.kt)("inlineCode",{parentName:"li"},"[*]")," for all items, ",(0,l.kt)("inlineCode",{parentName:"li"},"[...label]")," for filtered"),(0,l.kt)("li",{parentName:"ul"},"Ensure matching opening and closing loop tags"),(0,l.kt)("li",{parentName:"ul"},"Remove ",(0,l.kt)("inlineCode",{parentName:"li"},"{{~order_table mt=2 mb=2}}")," when using loops"))),(0,l.kt)("h2",{id:"code-examples"},"Code Examples"),(0,l.kt)("h3",{id:"curl"},"cURL"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Extract template metadata"',title:'"Extract',template:!0,'metadata"':!0},'curl -X POST https://api.epilot.cloud/v2/documents:meta \\\n  -H "Authorization: Bearer $TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "template_document": {\n      "s3ref": {\n        "bucket": "epilot-files-prod",\n        "key": "templates/contract.docx"\n      }\n    }\n  }\'\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Generate a document"',title:'"Generate',a:!0,'document"':!0},'curl -X POST https://api.epilot.cloud/v2/documents:generate \\\n  -H "Authorization: Bearer $TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "template_document": {\n      "s3ref": {\n        "bucket": "epilot-files-prod",\n        "key": "templates/invoice.docx"\n      }\n    },\n    "context_entity_id": "550e8400-e29b-41d4-a716-446655440000",\n    "variable_payload": {\n      "custom_message": "Thank you for your business!"\n    }\n  }\'\n')),(0,l.kt)("h3",{id:"template-settings"},"Template Settings"),(0,l.kt)("p",null,"Customize document margins and appearance:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="template_settings"',title:'"template_settings"'},'{\n  "template_settings": {\n    "top_margin": 1440,\n    "bottom_margin": 1440,\n    "left_margin": 1080,\n    "right_margin": 1080,\n    "show_guidelines": false,\n    "enable_headers": true,\n    "enable_footers": true\n  }\n}\n')),(0,l.kt)("h3",{id:"async-job-tracking"},"Async Job Tracking"),(0,l.kt)("p",null,"For large documents, poll the generation endpoint with the returned ",(0,l.kt)("inlineCode",{parentName:"p"},"job_id"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"const { job_id } = await client.generateDocument({ ... });\n\nconst poll = async (jobId: string) => {\n  const res = await client.generateDocument({ job_id: jobId });\n\n  if (res.job_status === 'SUCCESS') {\n    return res.pdf.preview_url;\n  } else if (res.job_status === 'FAILED') {\n    throw new Error('Generation failed');\n  }\n\n  // Still processing -- retry after delay\n  await new Promise((r) => setTimeout(r, 2000));\n  return poll(jobId);\n};\n")))}c.isMDXComponent=!0}}]);