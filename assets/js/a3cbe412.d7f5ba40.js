"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[18847],{35722:(e,t,n)=>{n.d(t,{G:()=>c});var i=n(42858),o=n(67294),r=n(25108);let s=0,a=!1;const l=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",i="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??i},c=e=>{let{chart:t,config:n}=e;const c=(0,o.useRef)(null),d=(0,o.useRef)("mermaid-"+s++),[u,p]=(0,o.useState)(""),h=(0,o.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=l(e,h);a||(i.Z.initialize({startOnLoad:!1,theme:n,...h?.mermaid||{}}),a=!0);(async()=>{try{const{svg:e}=await i.Z.render(d.current,t);p(e)}catch(e){r.error("Mermaid rendering failed:",e)}})()}),[t,h]),(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const o of n){if("attributes"!==o.type||"data-theme"!==o.attributeName)continue;const n=l(e,h);a=!1,i.Z.initialize({startOnLoad:!1,theme:n,...h?.mermaid||{}}),a=!0,d.current="mermaid-"+s++,i.Z.render(d.current,t).then((e=>{let{svg:t}=e;p(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,h]),"undefined"==typeof window?o.createElement("div",{className:"mermaid"},t):o.createElement("div",{ref:c,dangerouslySetInnerHTML:{__html:u}})}},91119:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>s,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var i=n(87462),o=(n(67294),n(3905));n(35722);const r={sidebar_position:10},s="Content-Security-Policy (CSP)",a={unversionedId:"journeys/content-security-policy",id:"journeys/content-security-policy",title:"Content-Security-Policy (CSP)",description:"Content Security Policy (CSP) is a feature that helps to prevent or minimize the risk of certain types of security threats. It consists of a series of instructions from a website to a browser, which instruct the browser to place restrictions on the things that the code comprising the site is allowed to do. Read more",source:"@site/docs/journeys/content-security-policy.md",sourceDirName:"journeys",slug:"/journeys/content-security-policy",permalink:"/docs/journeys/content-security-policy",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/journeys/content-security-policy.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"docsSidebar",previous:{title:"Custom CSS",permalink:"/docs/journeys/custom-css"},next:{title:"Concorde HTML Layout Overview",permalink:"/docs/ui-design/concorde-html-structure"}},l=[{value:"Recommended rules",id:"recommended-rules",children:[{value:"Alternative to <code>&#39;unsafe-inline&#39;</code>",id:"alternative-to-unsafe-inline",children:[],level:3}],level:2}],c={toc:l},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"content-security-policy-csp"},"Content-Security-Policy (CSP)"),(0,o.kt)("p",null,"Content Security Policy (CSP) is a feature that helps to prevent or minimize the risk of certain types of security threats. It consists of a series of instructions from a website to a browser, which instruct the browser to place restrictions on the things that the code comprising the site is allowed to do. ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP"},"Read more")),(0,o.kt)("p",null,"In case of Journeys, this is relevant if you're ",(0,o.kt)("a",{parentName:"p",href:"./embedding"},"embedding Journeys")," to your website and need to whitelist all associated features."),(0,o.kt)("h2",{id:"recommended-rules"},"Recommended rules"),(0,o.kt)("p",null,"Since Journeys are embedded through scripts and iframes, these are the suggested rules:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"script-src 'self' 'unsafe-inline' https://*.epilot.io https://*.epilot.cloud;\nframe-src 'self' https://*.epilot.io https://*.epilot.cloud;\n")),(0,o.kt)("p",null,"These rules break down as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"script-src")," allows loading scripts from epilot domains. The ",(0,o.kt)("inlineCode",{parentName:"li"},"'unsafe-inline'")," directive allows executing inline scripts needed to initialize the journey."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"frame-src")," allows embedding epilot iframes into your page.")),(0,o.kt)("h3",{id:"alternative-to-unsafe-inline"},"Alternative to ",(0,o.kt)("inlineCode",{parentName:"h3"},"'unsafe-inline'")),(0,o.kt)("p",null,"Instead of allowing all inline scripts, you can selectively allow only the ones responsible for embedding journeys, which is preferable from a security standpoint."),(0,o.kt)("p",null,"To selectively allow inline scripts to be executed, we recommend you use ",(0,o.kt)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html#nonce-based"},"nonces")," or ",(0,o.kt)("a",{parentName:"p",href:"https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html#hashes"},"hashes"),", and tweak your ",(0,o.kt)("inlineCode",{parentName:"p"},"script-src")," rule accordingly."),(0,o.kt)("p",null,"As an example, you would add the ",(0,o.kt)("inlineCode",{parentName:"p"},"nonce")," attribute to the embedding script you got from the Journey Builder, which is similar to the below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div id="epilot-{journey-uuid}" style="width:100%;text-align:left"></div>\n<script\n  data-ep-init="false"\n  src="https://embed.journey.epilot.io/bundle.js"\n><\/script>\n<script nonce="ee3ad7cc9b0f">\n  __epilot.init([\n    {\n      journeyId: \'{journey-uuid}\',\n      mode: \'inline\',\n      scrollToTop: true,\n      topBar: true,\n      lang: \'de\',\n    },\n  ])\n<\/script>\n')),(0,o.kt)("p",null,"Then add the following ",(0,o.kt)("inlineCode",{parentName:"p"},"script-src")," rule to your CSP header:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"script-src 'self' 'nonce-ee3ad7cc9b0f' https://*.epilot.io https://*.epilot.cloud;\n")))}u.isMDXComponent=!0}}]);