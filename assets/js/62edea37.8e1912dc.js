"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[11322],{35722:(t,e,n)=>{n.d(e,{G:()=>p});var a=n(42858),o=n(67294),i=n(25108);let l=0,r=!1;const s=(t,e)=>{const n=t?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return e?.theme?.[n]??e?.mermaid?.theme??a},p=t=>{let{chart:e,config:n}=t;const p=(0,o.useRef)(null),u=(0,o.useRef)("mermaid-"+l++),[d,k]=(0,o.useState)(""),m=(0,o.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const t=document.querySelector("html"),n=s(t,m);r||(a.Z.initialize({startOnLoad:!1,theme:n,...m?.mermaid||{}}),r=!0);(async()=>{try{const{svg:t}=await a.Z.render(u.current,e);k(t)}catch(t){i.error("Mermaid rendering failed:",t)}})()}),[e,m]),(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const t=document.querySelector("html"),n=new MutationObserver((n=>{for(const o of n){if("attributes"!==o.type||"data-theme"!==o.attributeName)continue;const n=s(t,m);r=!1,a.Z.initialize({startOnLoad:!1,theme:n,...m?.mermaid||{}}),r=!0,u.current="mermaid-"+l++,a.Z.render(u.current,e).then((t=>{let{svg:e}=t;k(e)}));break}}));return n.observe(t,{attributes:!0}),()=>n.disconnect()}),[e,m]),"undefined"==typeof window?o.createElement("div",{className:"mermaid"},e):o.createElement("div",{ref:p,dangerouslySetInnerHTML:{__html:d}})}},8841:(t,e,n)=>{n.r(e),n.d(e,{contentTitle:()=>r,default:()=>k,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var a=n(87462),o=(n(67294),n(3905)),i=n(35722);const l={title:"Workflow Task Automations",sidebar_position:5},r="Workflow Task Automations Integration Guide",s={unversionedId:"workflows/workflow-automations",id:"workflows/workflow-automations",title:"Workflow Task Automations",description:"This guide explains how to integrate external systems with the Workflows API to handle automated workflow tasks. Automated tasks are defined within a running workflow execution and trigger automation flows behind the scenes.",source:"@site/docs/workflows/workflow-automations.md",sourceDirName:"workflows",slug:"/workflows/workflow-automations",permalink:"/docs/workflows/workflow-automations",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/workflows/workflow-automations.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Workflow Task Automations",sidebar_position:5},sidebar:"docsSidebar",previous:{title:"Workflow in progress",permalink:"/docs/workflows/workflow-in-progress"},next:{title:"Blueprints",permalink:"/docs/blueprints/intro"}},p=[{value:"Overview",id:"overview",children:[],level:2},{value:"Integration Process",id:"integration-process",children:[{value:"Step 1: Search for Entities with Workflow Context",id:"step-1-search-for-entities-with-workflow-context",children:[],level:3},{value:"Step 2: Check for Automation Tasks",id:"step-2-check-for-automation-tasks",children:[],level:3},{value:"Step 3: Retrieve Full Workflow Execution",id:"step-3-retrieve-full-workflow-execution",children:[],level:3},{value:"Step 4: Find the Target Task",id:"step-4-find-the-target-task",children:[],level:3},{value:"Step 5: Trigger the Automation Execution",id:"step-5-trigger-the-automation-execution",children:[],level:3},{value:"Step 6: Monitor Automation Execution Status",id:"step-6-monitor-automation-execution-status",children:[],level:3},{value:"Step 7: Update the Workflow Task",id:"step-7-update-the-workflow-task",children:[],level:3},{value:"Status Mapping",id:"status-mapping",children:[],level:3}],level:2},{value:"Complete Integration Flow",id:"complete-integration-flow",children:[],level:2},{value:"Error Handling",id:"error-handling",children:[{value:"Automation Execution Fails",id:"automation-execution-fails",children:[],level:3},{value:"Timeout Handling",id:"timeout-handling",children:[],level:3}],level:2},{value:"Best Practices",id:"best-practices",children:[],level:2},{value:"API Reference Summary",id:"api-reference-summary",children:[],level:2},{value:"Related Documentation",id:"related-documentation",children:[],level:2}],u={toc:p},d="wrapper";function k(t){let{components:e,...n}=t;return(0,o.kt)(d,(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"workflow-task-automations-integration-guide"},"Workflow Task Automations Integration Guide"),(0,o.kt)("p",null,"This guide explains how to integrate external systems with the Workflows API to handle automated workflow tasks. Automated tasks are defined within a running workflow execution and trigger automation flows behind the scenes."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Workflow task automations allow you to execute automation flows as part of a workflow execution. When a workflow reaches an automated task (",(0,o.kt)("inlineCode",{parentName:"p"},'task_execution_type: "AUTOMATION"'),"), your system needs to:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Detect the automated task"),(0,o.kt)("li",{parentName:"ol"},"Trigger the automation execution"),(0,o.kt)("li",{parentName:"ol"},"Monitor the automation status"),(0,o.kt)("li",{parentName:"ol"},"Update the workflow task with the result")),(0,o.kt)("h2",{id:"integration-process"},"Integration Process"),(0,o.kt)("h3",{id:"step-1-search-for-entities-with-workflow-context"},"Step 1: Search for Entities with Workflow Context"),(0,o.kt)("p",null,"First, retrieve entities along with their workflow context using the Entity Search API."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"API Reference:")," ",(0,o.kt)("a",{parentName:"p",href:"/api/entity#tag/Entities/operation/searchEntities"},"Search Entities")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Request:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},'POST /v1/entity:search\nContent-Type: application/json\n\n{\n  "q": "...",\n  "hydrate": true\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "results": [\n    {\n      "_id": "11111111-1111-1111-1111-111111111111",\n      "_schema": "opportunity",\n      "_title": "Solar Installation Project",\n      "workflows": {\n        "rUqQv3Xd": [\n          {\n            "id": "85mk9wzyp98",\n            "definition_id": "rUqQv3Xd",\n            "name": "Solar Workflow",\n            "status": "STARTED",\n            "assignees": ["10014629", "10002602"],\n            "duedate": "2023-01-01T10:00:00.000Z",\n            "last_update_time": "2023-01-01T10:00:00.000Z",\n            "task_id": "8tpx9mi4ryb",\n            "task_name": "Clean Energy",\n            "task_assignees": ["10014629", "10002602", "10016846"],\n            "task_duedate": "2023-01-10T23:23:27.111Z",\n            "task_execution_type": "AUTOMATION",\n            "phase_id": "362pq2sy9ll",\n            "phase_name": "Research"\n          },\n          {\n            "id": "3ur6cry7r7x",\n            "definition_id": "rUqQv3Xd",\n            "name": "Solar Workflow",\n            "status": "STARTED",\n            "assignees": ["10014629", "10002602"],\n            "duedate": "2023-01-01T10:00:00.000Z",\n            "last_update_time": "2023-01-01T10:00:00.000Z",\n            "task_id": "7olrwq658ne",\n            "task_name": "Conclusions",\n            "task_assignees": ["10014629"],\n            "task_duedate": "2023-01-01T10:00:00.000Z",\n            "task_execution_type": "MANUAL",\n            "phase_id": "q2rivpohtla",\n            "phase_name": "Closing"\n          }\n        ],\n        "V_opYKRV": [\n          {\n            "id": "opse3yk2tit",\n            "definition_id": "V_opYKRV",\n            "name": "Wallbox Workflow",\n            "status": "STARTED",\n            "assignees": ["10014629", "10002602"],\n            "last_update_time": "2023-01-01T10:00:00.000Z",\n            "task_id": "rdaq2e48y00",\n            "task_name": "Schedule & perform E-Check on site",\n            "task_assignees": [],\n            "task_execution_type": "MANUAL",\n            "phase_id": "k0b4ht9i0vb",\n            "phase_name": "Pre-Check",\n            "task_duedate": "2023-01-01T10:00:00.000Z"\n          }\n        ],\n        "primary": {\n          "id": "85mk9wzyp98",\n          "definition_id": "rUqQv3Xd",\n          "name": "Solar Workflow",\n          "status": "STARTED",\n          "assignees": ["10014629", "10002602"],\n          "duedate": "2023-01-01T10:00:00.000Z",\n          "last_update_time": "2023-01-01T10:00:00.000Z",\n          "task_id": "8tpx9mi4ryb",\n          "task_name": "Clean Energy",\n          "task_assignees": ["10014629", "10002602", "10016846"],\n          "task_duedate": "2023-01-10T23:23:27.111Z",\n          "task_execution_type": "AUTOMATION",\n          "phase_id": "362pq2sy9ll",\n          "phase_name": "Research"\n        }\n      }\n    }\n  ]\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Key Fields:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"id"),": Workflow execution ID (e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},'"85mk9wzyp98"'),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"task_execution_type"),": Type of task execution (",(0,o.kt)("inlineCode",{parentName:"li"},'"AUTOMATION"')," or ",(0,o.kt)("inlineCode",{parentName:"li"},'"MANUAL"'),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"task_id"),": The specific task/step ID within the workflow"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"_id"),": Entity ID that the workflow is attached to")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-2-check-for-automation-tasks"},"Step 2: Check for Automation Tasks"),(0,o.kt)("p",null,"Filter the workflow context to identify automated tasks:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"const automationTasks = workflows[definitionId].filter(\n  workflow => workflow.task_execution_type === 'AUTOMATION'\n)\n")),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"task_execution_type === 'AUTOMATION'"),", proceed to retrieve the full workflow execution data."),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-3-retrieve-full-workflow-execution"},"Step 3: Retrieve Full Workflow Execution"),(0,o.kt)("p",null,"Use the workflow execution ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," from Step 1 to fetch the complete workflow data."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"API Reference:")," ",(0,o.kt)("a",{parentName:"p",href:"/api/workflow-execution#tag/Workflow-Executions/operation/getExecution"},"Get Workflow Execution")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Request:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},"GET /v1/workflows/executions/{id}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Example:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},"GET /v1/workflows/executions/85mk9wzyp98\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "85mk9wzyp98",\n  "definition_id": "rUqQv3Xd",\n  "name": "Solar Workflow",\n  "status": "STARTED",\n  "entity_id": "11111111-1111-1111-1111-111111111111",\n  "assignees": ["10014629", "10002602"],\n  "flow": [\n    {\n      "id": "8tpx9mi4ryb",\n      "name": "Clean Energy",\n      "type": "TASK",\n      "status": "STARTED",\n      "execution_type": "AUTOMATION",\n      "assignees": ["10014629", "10002602", "10016846"],\n      "duedate": "2023-01-10T23:23:27.111Z",\n      "automationConfig": {\n        "flowId": "abc123-automation-flow-id",\n        "execution_id": null,\n        "execution_status": null\n      },\n      "phase_id": "362pq2sy9ll"\n    },\n    {\n      "id": "7olrwq658ne",\n      "name": "Conclusions",\n      "type": "TASK",\n      "status": "PENDING",\n      "execution_type": "MANUAL",\n      "assignees": ["10014629"],\n      "duedate": "2023-01-01T10:00:00.000Z",\n      "phase_id": "q2rivpohtla"\n    }\n  ],\n  "created_at": "2023-01-01T09:00:00.000Z",\n  "updated_at": "2023-01-01T10:00:00.000Z"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Key Fields:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"flow"),": Array of all tasks/steps in the workflow"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"automationConfig.flowId"),": The automation flow ID to execute"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"execution_type"),": Confirms this is an ",(0,o.kt)("inlineCode",{parentName:"li"},'"AUTOMATION"')," task")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-4-find-the-target-task"},"Step 4: Find the Target Task"),(0,o.kt)("p",null,"Locate the specific task within the ",(0,o.kt)("inlineCode",{parentName:"p"},"flow")," array using the ",(0,o.kt)("inlineCode",{parentName:"p"},"task_id")," from Step 1. The flow can contain:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Top-level steps")," (",(0,o.kt)("inlineCode",{parentName:"li"},'type: "STEP"'),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Sections/Phases")," (",(0,o.kt)("inlineCode",{parentName:"li"},'type: "SECTION"'),") which contain a ",(0,o.kt)("inlineCode",{parentName:"li"},"steps")," array")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"function findTask(flow, taskId) {\n  for (const item of flow) {\n    if (item.type === 'STEP' && item.id === taskId) {\n      // Found top-level step\n      return item\n    }\n\n    if (item.type === 'SECTION' && item.steps) {\n      // Search within section/phase\n      const step = item.steps.find(s => s.id === taskId)\n      if (step) return step\n    }\n  }\n  return null\n}\n\nconst targetTask = findTask(workflowExecution.flow, '8tpx9mi4ryb')\nconst automationFlowId = targetTask.automationConfig.flowId\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-5-trigger-the-automation-execution"},"Step 5: Trigger the Automation Execution"),(0,o.kt)("p",null,"Use the ",(0,o.kt)("inlineCode",{parentName:"p"},"flowId")," from the task's ",(0,o.kt)("inlineCode",{parentName:"p"},"automationConfig")," to trigger the automation execution."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"API Reference:")," ",(0,o.kt)("a",{parentName:"p",href:"/api/automation#tag/executions/operation/startExecution"},"Start Automation Execution")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Request:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},'POST /v1/automation/executions\nContent-Type: application/json\n\n{\n  "entity_id": "11111111-1111-1111-1111-111111111111",\n  "flow_id": "abc123-automation-flow-id"\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n  "execution_status": "pending",\n  "entity_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "org_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "flow_id": "7791b04a-16d2-44a2-9af9-2d59c25c512f",\n  "flow_name": "Handle contact form",\n  "created_at": "2023-01-01T10:00:00.000Z",\n  "updated_at": "2023-01-01T10:00:00.000Z",\n  "current_action_id": "action-123",\n  "actions": [\n    {\n      "id": "action-123",\n      "name": "Send Email",\n      "type": "send-email",\n      "status": "pending"\n    }\n  ],\n  "trigger_context": {\n    "entity_id": "11111111-1111-1111-1111-111111111111"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Key Fields:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"id"),": The automation execution ID (e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},'"9baf184f-bc81-4128-bca3-d974c90a12c4"'),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"execution_status"),": Initial status, typically ",(0,o.kt)("inlineCode",{parentName:"li"},'"pending"'))),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-6-monitor-automation-execution-status"},"Step 6: Monitor Automation Execution Status"),(0,o.kt)("p",null,"Implement long polling to track the automation execution status. Poll every ",(0,o.kt)("strong",{parentName:"p"},"1 second")," until the execution reaches a terminal state."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"API Reference:")," ",(0,o.kt)("a",{parentName:"p",href:"/api/automation#tag/executions/operation/getExecution"},"Get Automation Execution")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Request:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},"GET /v1/automation/executions/{id}\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Example:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},"GET /v1/automation/executions/9baf184f-bc81-4128-bca3-d974c90a12c4\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response (In Progress):")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n  "execution_status": "in_progress",\n  "entity_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "org_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "flow_id": "7791b04a-16d2-44a2-9af9-2d59c25c512f",\n  "flow_name": "Handle contact form",\n  "created_at": "2023-01-01T10:00:00.000Z",\n  "updated_at": "2023-01-01T10:00:05.000Z",\n  "current_action_id": "action-123",\n  "actions": [\n    {\n      "id": "action-123",\n      "name": "Send Email",\n      "type": "send-email",\n      "status": "in_progress"\n    }\n  ],\n  "trigger_context": {\n    "entity_id": "11111111-1111-1111-1111-111111111111"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response (Completed):")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n  "execution_status": "success",\n  "entity_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "org_id": "e3d3ebac-baab-4395-abf4-50b5bf1f8b74",\n  "flow_id": "7791b04a-16d2-44a2-9af9-2d59c25c512f",\n  "flow_name": "Handle contact form",\n  "created_at": "2023-01-01T10:00:00.000Z",\n  "updated_at": "2023-01-01T10:00:30.000Z",\n  "current_action_id": "action-123",\n  "actions": [\n    {\n      "id": "action-123",\n      "name": "Send Email",\n      "type": "send-email",\n      "status": "success"\n    }\n  ],\n  "trigger_context": {\n    "entity_id": "11111111-1111-1111-1111-111111111111"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Terminal States:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"success")," - Automation completed successfully"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"failed")," - Automation encountered an error"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"cancelled")," - Automation was cancelled"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"skipped")," - Automation was skipped"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"hot")," - Automation is in a hot/error state")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Polling Implementation:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"async function pollAutomationStatus(executionId) {\n  const terminalStates = ['success', 'failed', 'cancelled', 'skipped', 'hot']\n\n  while (true) {\n    const response = await fetch(`/v1/automation/executions/${executionId}`)\n    const execution = await response.json()\n\n    if (terminalStates.includes(execution.execution_status)) {\n      return execution\n    }\n\n    // Wait 1 second before next poll\n    await new Promise(resolve => setTimeout(resolve, 1000))\n  }\n}\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"step-7-update-the-workflow-task"},"Step 7: Update the Workflow Task"),(0,o.kt)("p",null,"Once the automation execution completes, update the workflow task with the final status."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"API Reference:")," ",(0,o.kt)("a",{parentName:"p",href:"/api/workflow-execution#tag/Workflow-Steps/operation/updateStep"},"Update Workflow Step")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Request:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},'PATCH /v1/workflows/executions/{workflow_execution_id}/steps/{step_id}\nContent-Type: application/json\n\n{\n  "status": "COMPLETED",\n  "automationConfig": {\n    "flowId": "abc123-automation-flow-id",\n    "executionId": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n    "executionStatus": "success"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Example:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},'PATCH /v1/workflows/executions/85mk9wzyp98/steps/8tpx9mi4ryb\nContent-Type: application/json\n\n{\n  "status": "COMPLETED",\n  "automationConfig": {\n    "flowId": "abc123-automation-flow-id",\n    "executionId": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n    "executionStatus": "success"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Response:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id": "8tpx9mi4ryb",\n  "name": "Clean Energy",\n  "type": "STEP",\n  "status": "COMPLETED",\n  "execution_type": "AUTOMATION",\n  "assignees": ["10014629", "10002602", "10016846"],\n  "duedate": "2023-01-10T23:23:27.111Z",\n  "automationConfig": {\n    "flowId": "abc123-automation-flow-id",\n    "executionId": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n    "executionStatus": "success"\n  },\n  "completed_at": "2023-01-01T10:00:30.000Z"\n}\n')),(0,o.kt)("h3",{id:"status-mapping"},"Status Mapping"),(0,o.kt)("p",null,"Map the automation execution status to the appropriate workflow task status:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Automation Status"),(0,o.kt)("th",{parentName:"tr",align:null},"Workflow Task Status"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"success")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"COMPLETED")),(0,o.kt)("td",{parentName:"tr",align:null},"Task completed successfully")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"failed")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"FAILED")),(0,o.kt)("td",{parentName:"tr",align:null},"Task failed due to automation error")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"skipped")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"SKIPPED")),(0,o.kt)("td",{parentName:"tr",align:null},"Task was skipped")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"cancelled")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"SKIPPED")),(0,o.kt)("td",{parentName:"tr",align:null},"Task was cancelled")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"hot")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"FAILED")),(0,o.kt)("td",{parentName:"tr",align:null},"Task failed with critical error")))),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"complete-integration-flow"},"Complete Integration Flow"),(0,o.kt)(i.G,{chart:"sequenceDiagram\n    participant E as External System\n    participant EA as Entity API\n    participant WA as Workflow API\n    participant AA as Automation API\n\n    E->>EA: POST /v1/entity:search\n    EA--\x3e>E: Entity with workflow context\n\n    Note over E: Check if task_execution_type === 'AUTOMATION'\n\n    E->>WA: GET /v1/workflows/executions/{id}\n    WA--\x3e>E: Full workflow execution data\n\n    Note over E: Find task and extract automationConfig.flowId\n\n    E->>AA: POST /v1/automation/executions\n    AA--\x3e>E: Automation execution_id\n\n    loop Poll every 1 second\n        E->>AA: GET /v1/automation/executions/{execution_id}\n        AA--\x3e>E: Execution status\n        Note over E: Continue until terminal state\n    end\n\n    E->>WA: PATCH /v1/workflows/executions/{id}/steps/{step_id}\n    WA--\x3e>E: Updated task status",mdxType:"Mermaid"}),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"error-handling"},"Error Handling"),(0,o.kt)("h3",{id:"automation-execution-fails"},"Automation Execution Fails"),(0,o.kt)("p",null,"If the automation execution fails (",(0,o.kt)("inlineCode",{parentName:"p"},'execution_status: "failed"'),"), update the workflow task accordingly:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-http"},'PATCH /v1/workflows/executions/85mk9wzyp98/steps/8tpx9mi4ryb\nContent-Type: application/json\n\n{\n  "status": "FAILED",\n  "automationConfig": {\n    "flowId": "abc123-automation-flow-id",\n    "executionId": "9baf184f-bc81-4128-bca3-d974c90a12c4",\n    "executionStatus": "failed"\n  },\n  "error": {\n    "message": "Automation failed to complete",\n    "code": "AUTOMATION_FAILED"\n  }\n}\n')),(0,o.kt)("h3",{id:"timeout-handling"},"Timeout Handling"),(0,o.kt)("p",null,"Implement a maximum timeout for polling (e.g., 5 minutes):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"async function pollAutomationStatusWithTimeout(executionId, timeoutMs = 300000) {\n  const terminalStates = ['success', 'failed', 'cancelled', 'skipped', 'hot']\n  const startTime = Date.now()\n\n  while (Date.now() - startTime < timeoutMs) {\n    const response = await fetch(`/v1/automation/executions/${executionId}`)\n    const execution = await response.json()\n\n    if (terminalStates.includes(execution.execution_status)) {\n      return execution\n    }\n\n    await new Promise(resolve => setTimeout(resolve, 1000))\n  }\n\n  throw new Error('Automation execution timeout')\n}\n")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"best-practices"},"Best Practices"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Always check ",(0,o.kt)("inlineCode",{parentName:"strong"},"task_execution_type"))," before attempting to trigger automation"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Store the automation ",(0,o.kt)("inlineCode",{parentName:"strong"},"id"))," (execution ID) for tracking and debugging purposes"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Implement proper timeout handling")," to avoid infinite polling"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Log all API calls")," for troubleshooting"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Handle network errors")," gracefully with retry logic"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Update workflow tasks promptly")," after automation completion"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Monitor long-running automations")," and alert on timeouts"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Handle both top-level steps and sections")," when searching for tasks in the flow"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Use correct field names"),": ",(0,o.kt)("inlineCode",{parentName:"li"},"executionId")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"executionStatus")," when updating workflow tasks")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"api-reference-summary"},"API Reference Summary"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Endpoint"),(0,o.kt)("th",{parentName:"tr",align:null},"Method"),(0,o.kt)("th",{parentName:"tr",align:null},"Purpose"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/v1/entity:search")),(0,o.kt)("td",{parentName:"tr",align:null},"POST"),(0,o.kt)("td",{parentName:"tr",align:null},"Search entities with workflow context")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/v1/workflows/executions/{id}")),(0,o.kt)("td",{parentName:"tr",align:null},"GET"),(0,o.kt)("td",{parentName:"tr",align:null},"Retrieve full workflow execution")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/v1/automation/executions")),(0,o.kt)("td",{parentName:"tr",align:null},"POST"),(0,o.kt)("td",{parentName:"tr",align:null},"Trigger automation execution")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/v1/automation/executions/{execution_id}")),(0,o.kt)("td",{parentName:"tr",align:null},"GET"),(0,o.kt)("td",{parentName:"tr",align:null},"Check automation execution status")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/v1/workflows/executions/{id}/steps/{step_id}")),(0,o.kt)("td",{parentName:"tr",align:null},"PATCH"),(0,o.kt)("td",{parentName:"tr",align:null},"Update workflow task status")))),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"related-documentation"},"Related Documentation"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/workflow-execution"},"Workflows API Reference")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/automation"},"Automation API Reference")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/entity"},"Entity API Reference"))))}k.isMDXComponent=!0}}]);