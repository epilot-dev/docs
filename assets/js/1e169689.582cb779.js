"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[30063],{35722:(e,t,n)=>{n.d(t,{G:()=>d});var a=n(42858),i=n(67294),s=n(25108);let r=0,l=!1;const o=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??a},d=e=>{let{chart:t,config:n}=e;const d=(0,i.useRef)(null),p=(0,i.useRef)("mermaid-"+r++),[c,m]=(0,i.useState)(""),u=(0,i.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=o(e,u);l||(a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),l=!0);(async()=>{try{const{svg:e}=await a.Z.render(p.current,t);m(e)}catch(e){s.error("Mermaid rendering failed:",e)}})()}),[t,u]),(0,i.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const i of n){if("attributes"!==i.type||"data-theme"!==i.attributeName)continue;const n=o(e,u);l=!1,a.Z.initialize({startOnLoad:!1,theme:n,...u?.mermaid||{}}),l=!0,p.current="mermaid-"+r++,a.Z.render(p.current,t).then((e=>{let{svg:t}=e;m(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,u]),"undefined"==typeof window?i.createElement("div",{className:"mermaid"},t):i.createElement("div",{ref:d,dangerouslySetInnerHTML:{__html:c}})}},63218:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>o});var a=n(87462),i=(n(67294),n(3905));n(35722);const s={sidebar_position:5},r="Entity API",l={unversionedId:"entities/entity-api",id:"entities/entity-api",title:"Entity API",description:"[API Docs]",source:"@site/docs/entities/entity-api.md",sourceDirName:"entities",slug:"/entities/entity-api",permalink:"/docs/entities/entity-api",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/entities/entity-api.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"docsSidebar",previous:{title:"Entity Tables",permalink:"/docs/entities/entity-tables"},next:{title:"Relations",permalink:"/docs/entities/relations"}},o=[{value:"Schema API",id:"schema-api",children:[],level:2},{value:"CRUD API",id:"crud-api",children:[],level:2},{value:"Search API",id:"search-api",children:[{value:"Listing Entities",id:"listing-entities",children:[],level:3},{value:"Searching Entities",id:"searching-entities",children:[],level:3},{value:"Stable Queries",id:"stable-queries",children:[],level:3}],level:2},{value:"Relations API",id:"relations-api",children:[],level:2},{value:"Activity API",id:"activity-api",children:[],level:2}],d={toc:o},p="wrapper";function c(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"entity-api"},"Entity API"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity/#tag/Entities"},"API Docs"),"]\n[",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@epilot/entity-client"},"SDK"),"]"),(0,i.kt)("p",null,"The Entity API is the primary data layer for epilot business objects. It exposes five sub-APIs:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#schema-api"},"Schema API")," \u2014 define entity data models"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#crud-api"},"CRUD API")," \u2014 create, read, update, delete entities"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#search-api"},"Search API")," \u2014 list and search entities"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#relations-api"},"Relations API")," \u2014 manage links between entities"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#activity-api"},"Activity API")," \u2014 audit log for entity mutations")),(0,i.kt)("h2",{id:"schema-api"},"Schema API"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity/#tag/Schemas"},"API Docs"),"]"),(0,i.kt)("p",null,"The Schema API defines the data model for each organization's business entities. Schemas control how entities like Contacts, Orders, and Products are structured and displayed in the UI."),(0,i.kt)("p",null,"Schemas support versioning and can be created, updated, or deleted programmatically. See ",(0,i.kt)("a",{parentName:"p",href:"/docs/entities/core-entities"},"Core Entities")," for the built-in schemas."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="GET /v1/entity/schemas/contact"',title:'"GET','/v1/entity/schemas/contact"':!0},'{\n  "id": "5dbbe2c7-43c8-4043-b470-f41882efeefa",\n  "name": "Contact",\n  "plural": "Contacts",\n  "slug": "contact",\n  "icon": "person",\n  "published": true,\n  "title_template": "{{first_name}} {{last_name}}",\n  "ui_config": {\n    // ...\n  },\n  "group_settings": [\n    {\n      "id": "Personal Details",\n      "label": "Personal Details",\n      "expanded": true,\n      "order": 10\n    }\n    // ...\n  ],\n  "attributes": [\n    {\n      "label": "Last Name",\n      "name": "last_name",\n      "type": "string",\n      "group": "Personal Details",\n      "layout": "half_width",\n      "protected": true,\n      "order": 5\n    },\n    {\n      "label": "First Name",\n      "name": "first_name",\n      "type": "string",\n      "group": "Personal Details",\n      "layout": "half_width",\n      "protected": true,\n      "order": 6\n    }\n    //\n  ],\n  "capabilities": [\n    {\n      "name": "files",\n      "title": "Files",\n      "feature_flag": "ff_files_enabled",\n      "ui_hooks": [\n        {\n          "hook": "EntityDetailsV2:Tab",\n          "title": "Files",\n          "component": "EntityFiles",\n          "order": 50\n        }\n      ]\n    },\n    {\n      "name": "messages",\n      "title": "Messages",\n      "feature_flag": "ff_messaging_enabled",\n      "ui_hooks": [\n        {\n          "hook": "EntityDetailsV2:Tab",\n          "title": "Messages",\n          "import": "@epilot360/messaging",\n          "order": 51,\n          "requiredPermission": {\n            "action": "message:view"\n          }\n        }\n      ]\n    }\n    // ...\n  ],\n  "created_at": "2022-05-10T19:20:03.225Z",\n  "updated_at": "2022-08-19T15:49:13.387Z",\n  "version": 26\n}\n')),(0,i.kt)("h2",{id:"crud-api"},"CRUD API"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity/#tag/Entities"},"API Docs"),"]"),(0,i.kt)("p",null,"The CRUD API provides create, read, update, and delete operations for entity documents. Any JSON object can be stored as an entity."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="createEntity \u2014 POST /v1/entity/{schema}"',title:'"createEntity',"\u2014":!0,POST:!0,'/v1/entity/{schema}"':!0},'{\n  "hello": "world"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="getEntity \u2014 GET /v1/entity/{schema}/{id}"',title:'"getEntity',"\u2014":!0,GET:!0,'/v1/entity/{schema}/{id}"':!0},'{\n  "_id": "77f9e5ad-7809-4376-bbf1-817b3cadb94c",\n  "_schema": "exampleSchema",\n  "_created_at": "2022-09-01T00:00:00.000Z",\n  "_updated_at": "2022-09-01T00:00:00.000Z",\n  "hello": "world"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="updateEntity \u2014 PUT /v1/entity/{schema}/{id}"',title:'"updateEntity',"\u2014":!0,PUT:!0,'/v1/entity/{schema}/{id}"':!0},'{\n  "hello": "updated"\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text",metastring:'title="deleteEntity \u2014 DELETE /v1/entity/{schema}/{id}"',title:'"deleteEntity',"\u2014":!0,DELETE:!0,'/v1/entity/{schema}/{id}"':!0},"204 No Content\n")),(0,i.kt)("h2",{id:"search-api"},"Search API"),(0,i.kt)("p",null,"The Search API provides list and search functionality for entity documents."),(0,i.kt)("h3",{id:"listing-entities"},"Listing Entities"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity#operation/listEntities"},"API Docs"),"]"),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"listEntities")," for structured filtering with a subset of ",(0,i.kt)("a",{parentName:"p",href:"https://www.elastic.co/docs/explore-analyze/query-filter/languages/querydsl"},"Elasticsearch Query DSL"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="listEntities \u2014 POST /v1/entity:list"',title:'"listEntities',"\u2014":!0,POST:!0,'/v1/entity:list"':!0},'{\n  "filter": [\n    { "term": { "_schema": "exampleSchema" } },\n    { "term": { "hello": "world" } }\n  ],\n  "sort": "_created_at:desc",\n  "from": 0,\n  "size": 10,\n  "hydrate": false,\n  "fields": ["_id", "_title", "first_name"]\n}\n')),(0,i.kt)("h3",{id:"searching-entities"},"Searching Entities"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity#operation/searchEntities"},"API Docs"),"]"),(0,i.kt)("p",null,"Use ",(0,i.kt)("inlineCode",{parentName:"p"},"searchEntities")," for free-text search with Lucene query syntax:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="searchEntities \u2014 POST /v1/entity:search"',title:'"searchEntities',"\u2014":!0,POST:!0,'/v1/entity:search"':!0},'{\n  "q": "_schema:exampleSchema AND hello:world",\n  "sort": "_created_at:desc",\n  "from": 0,\n  "size": 10,\n  "hydrate": false,\n  "fields": ["_id", "_title", "first_name"]\n}\n')),(0,i.kt)("h3",{id:"stable-queries"},"Stable Queries"),(0,i.kt)("p",null,"Stable Queries let you paginate through large, changing datasets without missing or duplicating records. They provide consistency guarantees over a short time window, making them ideal for automation, bulk processing, and exports."),(0,i.kt)("p",null,"To use stable queries, pass ",(0,i.kt)("inlineCode",{parentName:"p"},"stable_for")," (seconds) on ",(0,i.kt)("inlineCode",{parentName:"p"},"listEntities")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"searchEntities"),". Always use the latest returned ",(0,i.kt)("inlineCode",{parentName:"p"},"stable_query_id")," in subsequent requests \u2014 the ID can change between pages. Combine with ",(0,i.kt)("inlineCode",{parentName:"p"},"search_after")," for precise deep pagination."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Keep the ",(0,i.kt)("inlineCode",{parentName:"p"},"stable_for")," TTL short. Stable windows consume server-side resources and are designed for batch operations, not interactive pagination."))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Use stable queries when:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Paginating more than a few pages in one batch"),(0,i.kt)("li",{parentName:"ul"},"Paginating beyond 25,000 records deep (",(0,i.kt)("inlineCode",{parentName:"li"},"from")," + ",(0,i.kt)("inlineCode",{parentName:"li"},"size"),")"),(0,i.kt)("li",{parentName:"ul"},"You need consistency guarantees (no missing/duplicate items)"),(0,i.kt)("li",{parentName:"ul"},"Running multiple queries against the same dataset snapshot")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Skip stable queries when:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Fetching a single page (up to 1,000 items, the max ",(0,i.kt)("inlineCode",{parentName:"li"},"size"),")"),(0,i.kt)("li",{parentName:"ul"},"The next page request depends on user input (the stable window may expire)")),(0,i.kt)("h2",{id:"relations-api"},"Relations API"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity/#tag/Relations"},"API Docs"),"]"),(0,i.kt)("p",null,"The Relations API manages links between entities. Relations are stored as attributes with a ",(0,i.kt)("inlineCode",{parentName:"p"},"$relation")," property on the entity document."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="addRelations \u2014 POST /v1/entity/{schema}/{id}/relations"',title:'"addRelations',"\u2014":!0,POST:!0,'/v1/entity/{schema}/{id}/relations"':!0},'[\n  {\n    "attribute": "products",\n    "entity_id": "e8878f62-2d3d-4c86-bfe7-01a4180ff048",\n    "_tags": []\n  }\n]\n')),(0,i.kt)("p",null,"Pass ",(0,i.kt)("inlineCode",{parentName:"p"},"?hydrate=true")," to retrieve full related entity data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="getRelations \u2014 GET /v1/entity/{schema}/{id}/relations?hydrate=true"',title:'"getRelations',"\u2014":!0,GET:!0,"/v1/entity/{schema}/{id}/relations?hydrate":'true"'},'[\n  {\n    "_id": "e8878f62-2d3d-4c86-bfe7-01a4180ff048",\n    "_schema": "product",\n    "_title": "Sample Product",\n    "price": 10000\n  }\n]\n')),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/docs/entities/relations"},"Relations")," for details on how relations are stored and queried."),(0,i.kt)("h2",{id:"activity-api"},"Activity API"),(0,i.kt)("p",null,"[",(0,i.kt)("a",{parentName:"p",href:"/api/entity#tag/Activity"},"API Docs"),"]"),(0,i.kt)("p",null,"The Activity API provides an append-only audit log for all entity mutations."),(0,i.kt)("p",null,"Each activity item contains a timestamp, the caller identity, a type, title, message, and a list of operations (",(0,i.kt)("inlineCode",{parentName:"p"},"createEntity"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"updateEntity"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"deleteEntity"),")."),(0,i.kt)("p",null,"Entity mutations automatically create activity entries. To group multiple operations under one activity, pass an existing ",(0,i.kt)("inlineCode",{parentName:"p"},"activity_id")," in the request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="getEntityActivityFeed \u2014 GET /v1/entity/{schema}/{id}/activity"',title:'"getEntityActivityFeed',"\u2014":!0,GET:!0,'/v1/entity/{schema}/{id}/activity"':!0},'{\n  "total": 1,\n  "results": [\n    {\n      "_id": "01F130Q52Q6MWSNS8N2AVXV4JN",\n      "timestamp": "2019-08-24T14:15:22Z",\n      "type": "MyCustomActivity",\n      "title": "My custom activity",\n      "message": "{{caller}} did something with {{entity payload.entity.id}}.",\n      "payload": {\n        "entity": {\n          "id": "77f9e5ad-7809-4376-bbf1-817b3cadb94c",\n          "schema": "exampleSchema"\n        }\n      },\n      "caller": {\n        "EpilotAuth": {\n          "token": {\n            "sub": "476e9b48-42f4-4234-a2b0-4668b34626ce",\n            "token_use": "access",\n            "auth_time": 1614333023,\n            "exp": 1614336623,\n            "iat": 1614333023,\n            "email": "example@epilot.cloud"\n          }\n        }\n      },\n      "operations": [\n        {\n          "entity": "77f9e5ad-7809-4376-bbf1-817b3cadb94c",\n          "org": "123",\n          "activity_id": "01F130Q52Q6MWSNS8N2AVXV4JN",\n          "operation": "createEntity",\n          "params": {\n            "id": "77f9e5ad-7809-4376-bbf1-817b3cadb94c",\n            "slug": "contact"\n          },\n          "payload": {\n            "_schema": "contact",\n            "_org": "123",\n            "status": "Inactive"\n          }\n        }\n      ]\n    }\n  ]\n}\n')))}c.isMDXComponent=!0}}]);