"use strict";(self.webpackChunkepilot_dev_handbook=self.webpackChunkepilot_dev_handbook||[]).push([[52540],{35722:(e,t,n)=>{n.d(t,{G:()=>l});var a=n(42858),o=n(67294),i=n(25108);let r=0,s=!1;const d=(e,t)=>{const n=e?.getAttribute("data-theme")??"light",a="dark"===n?"dark":"default";return t?.theme?.[n]??t?.mermaid?.theme??a},l=e=>{let{chart:t,config:n}=e;const l=(0,o.useRef)(null),u=(0,o.useRef)("mermaid-"+r++),[c,p]=(0,o.useState)(""),m=(0,o.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]);return(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=d(e,m);s||(a.Z.initialize({startOnLoad:!1,theme:n,...m?.mermaid||{}}),s=!0);(async()=>{try{const{svg:e}=await a.Z.render(u.current,t);p(e)}catch(e){i.error("Mermaid rendering failed:",e)}})()}),[t,m]),(0,o.useEffect)((()=>{if("undefined"==typeof window)return;const e=document.querySelector("html"),n=new MutationObserver((n=>{for(const o of n){if("attributes"!==o.type||"data-theme"!==o.attributeName)continue;const n=d(e,m);s=!1,a.Z.initialize({startOnLoad:!1,theme:n,...m?.mermaid||{}}),s=!0,u.current="mermaid-"+r++,a.Z.render(u.current,t).then((e=>{let{svg:t}=e;p(t)}));break}}));return n.observe(e,{attributes:!0}),()=>n.disconnect()}),[t,m]),"undefined"==typeof window?o.createElement("div",{className:"mermaid"},t):o.createElement("div",{ref:l,dangerouslySetInnerHTML:{__html:c}})}},25293:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var a=n(87462),o=(n(67294),n(3905));n(35722);const i={sidebar_position:4,title:"JSONata Customization"},r="Customization",s={unversionedId:"integrations/webhooks/payload-structure/customization",id:"integrations/webhooks/payload-structure/customization",title:"JSONata Customization",description:"[API Docs]",source:"@site/docs/integrations/webhooks/payload-structure/customization.md",sourceDirName:"integrations/webhooks/payload-structure",slug:"/integrations/webhooks/payload-structure/customization",permalink:"/docs/integrations/webhooks/payload-structure/customization",editUrl:"https://github.com/epilot-dev/docs/edit/main/docs/integrations/webhooks/payload-structure/customization.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"JSONata Customization"},sidebar:"docsSidebar",previous:{title:"Trigger: Automation Action",permalink:"/docs/integrations/webhooks/payload-structure/automation-trigger"},next:{title:"Security",permalink:"/docs/integrations/webhooks/security"}},d=[{value:"JSONata Payload Transformation",id:"jsonata-payload-transformation",children:[{value:"How to Use JSONata",id:"how-to-use-jsonata",children:[],level:3},{value:"Example",id:"example",children:[],level:3}],level:2},{value:"Additional Attributes",id:"additional-attributes",children:[],level:2},{value:"Custom Headers",id:"custom-headers",children:[],level:2},{value:"Custom OAuth Parameters",id:"custom-oauth-parameters",children:[],level:2}],l={toc:d},u="wrapper";function c(e){let{components:t,...i}=e;return(0,o.kt)(u,(0,a.Z)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"customization"},"Customization"),(0,o.kt)("p",null,"[",(0,o.kt)("a",{parentName:"p",href:"/api/webhooks"},"API Docs"),"]\n[",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/@epilot/webhooks-client"},"SDK"),"]"),(0,o.kt)("h2",{id:"jsonata-payload-transformation"},"JSONata Payload Transformation"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://jsonata.org/"},"JSONata")," is a lightweight query and transformation language for JSON data. Use it to reshape, filter, or extract specific fields from the webhook payload before delivery."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Test your JSONata expressions in the ",(0,o.kt)("a",{parentName:"p",href:"https://try.jsonata.org/"},"JSONata online editor")," before deploying to production. The webhook configuration UI also includes a built-in test feature."))),(0,o.kt)("h3",{id:"how-to-use-jsonata"},"How to Use JSONata"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open the webhook configuration in the epilot portal"),(0,o.kt)("li",{parentName:"ol"},"Select the JSONata transformation option"),(0,o.kt)("li",{parentName:"ol"},"Enter your JSONata expression"),(0,o.kt)("li",{parentName:"ol"},"Use the built-in test feature to verify the output")),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"Given this webhook payload for an opportunity:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "metadata": {\n    "webhook_id": "kT5iDYx373p6v6hWGJVn9j",\n    "organization_id": "739224",\n    "webhook_name": "Webhook",\n    "automation_name": "FLOW#wfjV8L8-fD#TASK#25bdd4ec-4335-434b-938e-9afd91cdc9d5",\n    "organization_name": "Example Org",\n    "correlation_id": "d7fc4288-381c-41cc-ba74-535e3ae84a0b",\n    "creation_timestamp": "2025-07-09T11:50:25.933Z",\n    "execution_id": "5cc9432c-a2ae-4649-93e5-ec528eb4e1e4",\n    "action_id": "64ec83d2-fa59-44ab-9d27-8dbcbdfde2a9"\n  },\n  "entity": {\n    "status": "open",\n    "source": {\n      "title": "manual",\n      "href": null\n    },\n    "source_type": "manual",\n    "_schema": "opportunity",\n    "_id": "21e2c48f-ec99-4cd3-8552-b776c0c0aec5",\n    "_org": "739224",\n    "_owners": [\n      {\n        "org_id": "739224",\n        "user_id": "10010729"\n      }\n    ],\n    "_created_at": "2025-07-03T06:15:39.776Z",\n    "_updated_at": "2025-07-08T13:43:11.069Z",\n    "opportunity_number": "OP-6376",\n    "_title": "OP-6376",\n    "_acl": {\n      "view": [\n        "org_739224"\n      ],\n      "edit": [\n        "org_739224"\n      ],\n      "delete": [\n        "org_739224"\n      ]\n    }\n  },\n  "relations": []\n  }\n}\n')),(0,o.kt)("p",null,"Apply this JSONata expression:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "org_id": metadata.organization_id,\n    "user_id": $number(entity._owners.user_id),\n    "lead_nr": entity.opportunity_number,\n    "status": entity.status\n}\n')),(0,o.kt)("p",null,"The resulting payload:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "org_id": "739224",\n    "user_id": 10010729,\n    "lead_nr": "OP-6376",\n    "status": "open"\n}\n')),(0,o.kt)("h2",{id:"additional-attributes"},"Additional Attributes"),(0,o.kt)("p",null,"You can include optional data sections in the webhook payload. The base structure supports these optional sections:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"{\n   metadata: {\n    organization_id: '',\n    ...\n   }, // always present\n   entity: {} // always present,\n   relations: {} // optional,\n   activity: {} // optional,\n   changed_attributes: {\n      added: {},\n      deleted: {},\n      updated: {}\n   } // optional\n}\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Include Changed Attributes")," \u2014 Shows added, deleted, and updated attributes after the event. Only populated for change events (e.g., ",(0,o.kt)("inlineCode",{parentName:"li"},"Entity update: Opportunity"),"). Manual triggers do not include changed attributes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Include Activity")," \u2014 Adds activity data to the payload."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Include Relations")," \u2014 Adds hydrated relations to other entities. Note: this can significantly increase payload size.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Custom Webhook Payload Configuration",src:n(66769).Z,width:"1990",height:"898"})),(0,o.kt)("h2",{id:"custom-headers"},"Custom Headers"),(0,o.kt)("p",null,"Add custom headers to webhook requests for additional authentication or metadata."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Custom Webhook Header",src:n(6364).Z,width:"1186",height:"428"})),(0,o.kt)("p",null,"The following headers are forbidden and will be removed from the request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    'x-epilot-org-id',\n    'Authorization',\n    'A-IM',\n    'Accept-Charset',\n    'Accept-Datetime',\n    'Accept-Encoding',\n    'Cache-Control',\n    'Connection',\n    'Content-Length',\n    'Content-Encoding',\n    'Transfer-Encoding',\n    'Host',\n    'Content-Type',\n    'Content-Range',\n    'Content-MD5',\n    'Range',\n    'User-Agent',\n    'Date',\n    'Expect',\n    'Forwarded',\n    'From',\n    'Host',\n    'HTTP2-Settings',\n    'If-Match',\n    'If-Modified-Since',\n    'If-None-Match',\n    'If-Range',\n    'If-Unmodified-Since',\n    'Max-Forwards',\n    'Origin',\n    'Pragma',\n    'Proxy-Authorization',\n    'Referer',\n    'Server',\n    'TE',\n    'Trailer',\n    'Transfer-Encoding',\n    'Upgrade',\n    'Via',\n    'Warning',\n    'x-forwarded-*',\n    'x-amz-*',\n    'x-amzn-*'\n")),(0,o.kt)("h2",{id:"custom-oauth-parameters"},"Custom OAuth Parameters"),(0,o.kt)("p",null,"Add custom parameters to the OAuth token request as body, query, or header parameters. This is useful when your authorization server requires additional context beyond the standard OAuth fields."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Custom Webhook OAuth Parameter",src:n(94764).Z,width:"954",height:"1102"})))}c.isMDXComponent=!0},6364:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/custom-header-a6596c0a6920e984be22411a65f732e3.png"},94764:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/custom-oauth-b9ad4aafa692632ee4d4e17a1d1abfab.png"},66769:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/custom-payload-5f4ae66c6785463dc95e484832eca2dc.png"}}]);